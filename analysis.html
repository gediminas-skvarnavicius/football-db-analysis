<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.290">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Analysis of the Football Database</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="analysis_files/libs/quarto-html/quarto.js"></script>
<script src="analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#imports-and-options" id="toc-imports-and-options" class="nav-link" data-scroll-target="#imports-and-options"><span class="header-section-number">1.1</span> Imports and Options</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis"><span class="header-section-number">2</span> Exploratory data analysis</a>
  <ul class="collapse">
  <li><a href="#match" id="toc-match" class="nav-link" data-scroll-target="#match"><span class="header-section-number">2.1</span> Match</a></li>
  <li><a href="#player-attributes" id="toc-player-attributes" class="nav-link" data-scroll-target="#player-attributes"><span class="header-section-number">2.2</span> Player attributes</a></li>
  <li><a href="#team-attributes" id="toc-team-attributes" class="nav-link" data-scroll-target="#team-attributes"><span class="header-section-number">2.3</span> Team Attributes</a></li>
  </ul></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection"><span class="header-section-number">3</span> Feature selection</a>
  <ul class="collapse">
  <li><a href="#starting-line-up-combinations" id="toc-starting-line-up-combinations" class="nav-link" data-scroll-target="#starting-line-up-combinations"><span class="header-section-number">3.1</span> Starting line-up combinations</a></li>
  <li><a href="#team-attributes-1" id="toc-team-attributes-1" class="nav-link" data-scroll-target="#team-attributes-1"><span class="header-section-number">3.2</span> Team Attributes</a></li>
  <li><a href="#player-attributes-1" id="toc-player-attributes-1" class="nav-link" data-scroll-target="#player-attributes-1"><span class="header-section-number">3.3</span> Player Attributes</a></li>
  </ul></li>
  <li><a href="#game-outcome-prediction-models" id="toc-game-outcome-prediction-models" class="nav-link" data-scroll-target="#game-outcome-prediction-models"><span class="header-section-number">4</span> Game outcome prediction models</a>
  <ul class="collapse">
  <li><a href="#home-win" id="toc-home-win" class="nav-link" data-scroll-target="#home-win"><span class="header-section-number">4.1</span> Home win</a></li>
  <li><a href="#away-win" id="toc-away-win" class="nav-link" data-scroll-target="#away-win"><span class="header-section-number">4.2</span> Away win</a></li>
  <li><a href="#win-loss-tie-classification" id="toc-win-loss-tie-classification" class="nav-link" data-scroll-target="#win-loss-tie-classification"><span class="header-section-number">4.3</span> Win-Loss-Tie Classification</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">5</span> Summary</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis of the Football Database</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>This is the analysis of the <a href="https://www.kaggle.com/datasets/prajitdatta/ultimate-25k-matches-football-database-european">football data set from Kaggle</a>. The aims of this project are to explore the data set and eventually gain insights on potential betting strategies by building models that predict match outcomes.</p>
<section id="imports-and-options" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="imports-and-options"><span class="header-section-number">1.1</span> Imports and Options</h3>
<section id="imports" class="level4" data-number="1.1.1">
<h4 data-number="1.1.1" class="anchored" data-anchor-id="imports"><span class="header-section-number">1.1.1</span> Imports</h4>
<div class="cell" data-execution_count="1">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>reload_ext autoreload</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">1</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Data handling</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown, display</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mplsoccer <span class="im">import</span> Pitch</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> RFECV</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, roc_auc_score</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lmfit <span class="im">import</span> Minimizer, Parameters</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functions.display_functions <span class="im">as</span> disf</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functions.data_format_functions <span class="im">as</span> dff</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions.project_functions_classes <span class="im">import</span> Team, MatchPlayers</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions.project_functions_classes <span class="im">import</span> outcome_guess_prob_dif</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions.project_functions_classes <span class="im">import</span> outcome_guess_prob_win</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions.project_functions_classes <span class="im">import</span> classifier_train_prob_win</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions.project_functions_classes <span class="im">import</span> classifier_train_prob_dif</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>aimport functions.display_functions</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>aimport functions.project_functions_classes</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>aimport functions.data_format_functions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="options" class="level4" data-number="1.1.2">
<h4 data-number="1.1.2" class="anchored" data-anchor-id="options"><span class="header-section-number">1.1.2</span> Options</h4>
<section id="pandas-and-figure-options" class="level5">
<h5 class="anchored" data-anchor-id="pandas-and-figure-options">Pandas and figure options:</h5>
<div class="cell" data-execution_count="2">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"mode.chained_assignment"</span>, <span class="va">None</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>base_fig_width <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>base_fig_height <span class="op">=</span> <span class="fl">4.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="duckdb-connection-and-options" class="level5">
<h5 class="anchored" data-anchor-id="duckdb-connection-and-options">DuckDB connection and options:</h5>
<div class="cell" data-execution_count="3">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> duckdb.<span class="ex">connect</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>con.execute(<span class="ss">f"INSTALL sqlite"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>con.execute(<span class="ss">f"LOAD sqlite"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>con.execute(<span class="ss">f"SET GLOBAL sqlite_all_varchar=true"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>con.execute(<span class="ss">f"CALL sqlite_attach('data/database.sqlite')"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>&lt;duckdb.DuckDBPyConnection at 0x7f1f96457470&gt;</code></pre>
</div>
</div>
</section>
<section id="fetching-table-and-column-names" class="level5">
<h5 class="anchored" data-anchor-id="fetching-table-and-column-names">Fetching table and column names:</h5>
<div class="cell" data-execution_count="4">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> con.query(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""--sql</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ss">SELECT table_name as 'Table Name',</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ss">    COUNT(column_name) AS 'Column Count'</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ss">FROM information_schema.columns</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ss">GROUP BY table_name</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>).to_df()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>table_columns <span class="op">=</span> con.query(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""--sql</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="ss">SELECT table_name,</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="ss">    GROUP_CONCAT(column_name) AS column_names</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="ss">FROM information_schema.columns</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="ss">GROUP BY table_name"""</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>).to_df()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>tables[<span class="st">"column_names"</span>] <span class="op">=</span> table_columns[<span class="st">"column_names"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.split(<span class="st">","</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="significance" class="level5">
<h5 class="anchored" data-anchor-id="significance">Significance:</h5>
<div class="cell" data-execution_count="5">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>significance <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> alpha</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
</section>
<section id="exploratory-data-analysis" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="exploratory-data-analysis"><span class="header-section-number">2</span> Exploratory data analysis</h2>
<p>The goal of this section is to familiarize with the data set. Some statistical inference is presented here, but the feature selection for ML models are presented in a separate section and mostly relies on their predictive power.</p>
<section id="match" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="match"><span class="header-section-number">2.1</span> Match</h3>
<p>The data set includes data on more than 25 thousand matches. Outcomes, betting odds, players, teams, and their starting lineup positions are given. This section explores match related portion of the data set.</p>
<section id="preparing-match-data" class="level5">
<h5 class="anchored" data-anchor-id="preparing-match-data">Preparing Match data:</h5>
<div class="cell" data-execution_count="6">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>match_cols <span class="op">=</span> tables.loc[tables[<span class="st">"Table Name"</span>] <span class="op">==</span> <span class="st">"Match"</span>, <span class="st">"column_names"</span>].to_list()[<span class="dv">0</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>match_cols_to_remove <span class="op">=</span> [<span class="st">"league_id"</span>, <span class="st">"stage"</span>, <span class="st">"match_api_id"</span>, <span class="st">"cross"</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>match_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> match_cols <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> match_cols_to_remove]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>match_raw <span class="op">=</span> con.query(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""--sql</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ss">          SELECT </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(match_cols)<span class="sc">}</span><span class="ss"> FROM Match</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ss">          """</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>).to_df()</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>match_raw.set_index(<span class="st">"id"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="what-in-what-countries-and-leagues-were-the-matches-played-in-by-which-teams-and-in-which-leagues-were-the-most-goals-scored-in" class="level4" data-number="2.1.1">
<h4 data-number="2.1.1" class="anchored" data-anchor-id="what-in-what-countries-and-leagues-were-the-matches-played-in-by-which-teams-and-in-which-leagues-were-the-most-goals-scored-in"><span class="header-section-number">2.1.1</span> What in what countries and leagues were the matches played in? By which teams and in which leagues were the most goals scored in?</h4>
<iframe width="850" height="638" src="https://lookerstudio.google.com/embed/reporting/7fdf4aab-2c53-454b-8e7e-adc93591e2dd/page/fsdXD" frameborder="0" style="border:0" allowfullscreen="">
</iframe>
<p>The Matches were played in 11 different leagues across 11 different European countries. The most goals per match were scored in Netherlands Eredivisie, while the team that scored the most goals per match was FC Barcelona.</p>
</section>
<section id="whats-the-number-of-matches-distribution-across-the-timeline-and-seasons" class="level4" data-number="2.1.2">
<h4 data-number="2.1.2" class="anchored" data-anchor-id="whats-the-number-of-matches-distribution-across-the-timeline-and-seasons"><span class="header-section-number">2.1.2</span> Whats the number of matches distribution across the timeline and seasons?</h4>
<section id="preparing-the-season-and-date-data" class="level5">
<h5 class="anchored" data-anchor-id="preparing-the-season-and-date-data">Preparing the season and date data:</h5>
<div class="cell" data-execution_count="7">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>match_raw[<span class="st">"date"</span>] <span class="op">=</span> pd.to_datetime(match_raw[<span class="st">"date"</span>])</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>match_date_count <span class="op">=</span> match_raw.resample(<span class="st">"D"</span>, on<span class="op">=</span><span class="st">"date"</span>).count().cumsum()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>seasons <span class="op">=</span> match_raw.groupby(<span class="st">"season"</span>).agg(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    start<span class="op">=</span>(<span class="st">"date"</span>, <span class="st">"min"</span>), end<span class="op">=</span>(<span class="st">"date"</span>, <span class="st">"max"</span>), count<span class="op">=</span>(<span class="st">"season"</span>, <span class="st">"count"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>seasons[<span class="st">"length"</span>] <span class="op">=</span> seasons[<span class="st">"end"</span>] <span class="op">-</span> seasons[<span class="st">"start"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot" class="level5">
<h5 class="anchored" data-anchor-id="plot">Plot:</h5>
<div class="cell" data-execution_count="8">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fig_match_count_date, ax_match_count_date <span class="op">=</span> plt.subplots(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(base_fig_width, base_fig_height)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>ax_match_count_date.plot(match_date_count.index, match_date_count[<span class="st">"country_id"</span>])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ax_match_count_date_season <span class="op">=</span> ax_match_count_date.twinx()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>ax_match_count_date_season.bar(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>seasons[<span class="st">"start"</span>],</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span>seasons[<span class="st">"count"</span>],</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>seasons[<span class="st">"length"</span>],</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    align<span class="op">=</span><span class="st">"edge"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.25</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>ax_match_count_date.set_ylabel(<span class="st">"Total Matches"</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>ax_match_count_date_season.set_ylabel(<span class="st">"Matches by Season"</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-match_count" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-match_count-output-1.png" class="quarto-discovered-preview-image img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: The cumulative sum of total matches played are represented by the blue line, the bars in the background indicate the number of matches played that season and its time span.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Matches are in the data set were played from 2008 to 2016 in 8 seasons.</p>
</section>
</section>
<section id="what-is-the-distribution-of-goal-difference-between-home-and-away-teams" class="level4" data-number="2.1.3">
<h4 data-number="2.1.3" class="anchored" data-anchor-id="what-is-the-distribution-of-goal-difference-between-home-and-away-teams"><span class="header-section-number">2.1.3</span> What is the distribution of goal difference between home and away teams?</h4>
<section id="calculating-the-goal-difference-for-each-mach" class="level5">
<h5 class="anchored" data-anchor-id="calculating-the-goal-difference-for-each-mach">Calculating the goal difference for each mach:</h5>
<div class="cell" data-execution_count="9">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>match_raw[[<span class="st">"home_team_goal"</span>, <span class="st">"away_team_goal"</span>]] <span class="op">=</span> match_raw[</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"home_team_goal"</span>, <span class="st">"away_team_goal"</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>].astype(<span class="bu">int</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>match_raw[<span class="st">"outcome"</span>] <span class="op">=</span> match_raw[<span class="st">"home_team_goal"</span>] <span class="op">-</span> match_raw[<span class="st">"away_team_goal"</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>match_outcomes <span class="op">=</span> match_raw[<span class="st">"outcome"</span>].value_counts().to_frame(<span class="st">"count"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>match_outcomes.reset_index(names<span class="op">=</span>[<span class="st">"value"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>match_outcomes[<span class="st">"outcome"</span>] <span class="op">=</span> match_outcomes[<span class="st">"value"</span>].<span class="bu">apply</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="st">"Home Win"</span> <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> (<span class="st">"Home Loss"</span> <span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"Tie"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>match_outcomes[<span class="st">"color"</span>] <span class="op">=</span> match_outcomes[<span class="st">"value"</span>].<span class="bu">apply</span>(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: sns.color_palette()[<span class="dv">0</span>]</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> (sns.color_palette()[<span class="dv">3</span>] <span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">else</span> sns.color_palette()[<span class="dv">4</span>])</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot-1" class="level5">
<h5 class="anchored" data-anchor-id="plot-1">Plot:</h5>
<div class="cell" data-execution_count="10">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fig_match_outcomes, ax_match_outcomes <span class="op">=</span> plt.subplots(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(base_fig_width, base_fig_height)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>ax_match_outcomes.bar(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    match_outcomes[<span class="st">"value"</span>],</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    match_outcomes[<span class="st">"count"</span>],</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span>match_outcomes[<span class="st">"outcome"</span>],</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>match_outcomes[<span class="st">"color"</span>],</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    align<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>handles, labels <span class="op">=</span> ax_match_outcomes.get_legend_handles_labels()</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>ax_match_outcomes.legend(handles[:<span class="dv">3</span>], labels[:<span class="dv">3</span>])</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>ax_match_outcomes.<span class="bu">set</span>(xticks<span class="op">=</span>np.arange(start<span class="op">=-</span><span class="dv">8</span>, stop<span class="op">=</span><span class="dv">12</span>, step<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>ax_match_outcomes.set_ylabel(<span class="st">"Number of Matches"</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>ax_match_outcomes.set_xlabel(<span class="st">"Goal Difference"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-match_outcomes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-match_outcomes-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: The number of matches that ended with a specific goal difference.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Visual inspection of the match outcome data suggests that there might be a home advantage. Another important observation is that a large portion of matches end in ties.</p>
</section>
</section>
<section id="is-there-a-home-advantage" class="level4" data-number="2.1.4">
<h4 data-number="2.1.4" class="anchored" data-anchor-id="is-there-a-home-advantage"><span class="header-section-number">2.1.4</span> Is there a home advantage?</h4>
<section id="chi-square-test-of-non-tie-matches-with-the-null-hypothesis-being-that-there-is-an-equal-amount-of-home-wins-and-away-wins" class="level5">
<h5 class="anchored" data-anchor-id="chi-square-test-of-non-tie-matches-with-the-null-hypothesis-being-that-there-is-an-equal-amount-of-home-wins-and-away-wins">Chi square test of non-tie matches with the null hypothesis being that there is an equal amount of home wins and away wins:</h5>
<div class="cell" data-execution_count="11">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>total_home_wins <span class="op">=</span> match_outcomes.loc[</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    match_outcomes[<span class="st">"outcome"</span>] <span class="op">==</span> <span class="st">"Home Win"</span>, <span class="st">"count"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>].<span class="bu">sum</span>()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>total_away_wins <span class="op">=</span> match_outcomes.loc[</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    match_outcomes[<span class="st">"outcome"</span>] <span class="op">==</span> <span class="st">"Home Loss"</span>, <span class="st">"count"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>].<span class="bu">sum</span>()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>home_advantage_result <span class="op">=</span> stats.chisquare([total_home_wins, total_away_wins])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="results" class="level5">
<h5 class="anchored" data-anchor-id="results">Results:</h5>
<div class="cell" data-execution_count="12">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Markdown(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ss">Based on a chi-square test with a confidence level of 95%, the p-value of </span><span class="sc">{</span>home_advantage_result<span class="sc">.</span>pvalue<span class="sc">:.2e}</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ss">strongly suggests that there is a significant home advantage.</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>total_home_wins<span class="sc">}</span><span class="ss"> of all non-tie wins were by the home team,</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ss">while only </span><span class="sc">{</span>total_away_wins<span class="sc">}</span><span class="ss"> matches were won by away teams.</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<p>Based on a chi-square test with a confidence level of 95%, the p-value of 2.82e-224 strongly suggests that there is a significant home advantage. 11917 of all non-tie wins were by the home team, while only 7466 matches were won by away teams.</p>
</div>
</div>
</section>
</section>
<section id="what-are-the-different-player-combinations-used" class="level4" data-number="2.1.5">
<h4 data-number="2.1.5" class="anchored" data-anchor-id="what-are-the-different-player-combinations-used"><span class="header-section-number">2.1.5</span> What are the different player combinations used?</h4>
<p>The data set includes starting lineup positions on the field.</p>
<section id="preparing-player-position-combination-columns" class="level5">
<h5 class="anchored" data-anchor-id="preparing-player-position-combination-columns">Preparing player position combination columns:</h5>
<div class="cell" data-execution_count="13">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting lists of position column names</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>home_x_cols <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> match_raw.columns.to_list() <span class="cf">if</span> <span class="st">"home_player_X"</span> <span class="kw">in</span> x]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>home_y_cols <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> match_raw.columns.to_list() <span class="cf">if</span> <span class="st">"home_player_Y"</span> <span class="kw">in</span> x]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>away_x_cols <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> match_raw.columns.to_list() <span class="cf">if</span> <span class="st">"away_player_X"</span> <span class="kw">in</span> x]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>away_y_cols <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> match_raw.columns.to_list() <span class="cf">if</span> <span class="st">"away_player_Y"</span> <span class="kw">in</span> x]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing  the data type to numeric</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>match_raw[home_x_cols <span class="op">+</span> home_y_cols <span class="op">+</span> away_x_cols <span class="op">+</span> away_y_cols] <span class="op">=</span> match_raw[</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    home_x_cols <span class="op">+</span> home_y_cols <span class="op">+</span> away_x_cols <span class="op">+</span> away_y_cols</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>].<span class="bu">apply</span>(pd.to_numeric)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Putting the home player coordinates into frozensets of (x,y) tuples</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>match_raw[<span class="st">"combinations_home"</span>] <span class="op">=</span> match_raw.<span class="bu">apply</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> row: <span class="bu">frozenset</span>([(x, y) <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(row[home_x_cols], row[home_y_cols])]),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing any values that contain at least a single NaN value to Nan</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>match_raw[<span class="st">"combinations_home"</span>] <span class="op">=</span> match_raw[<span class="st">"combinations_home"</span>].<span class="bu">apply</span>(</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: np.nan <span class="cf">if</span> <span class="bu">any</span>(np.isnan(y) <span class="cf">for</span> tup <span class="kw">in</span> x <span class="cf">for</span> y <span class="kw">in</span> tup) <span class="cf">else</span> x</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing frozensets with less than 11 player coordinates</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>match_raw[<span class="st">"combinations_home"</span>] <span class="op">=</span> match_raw[<span class="st">"combinations_home"</span>].<span class="bu">apply</span>(</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: x <span class="cf">if</span> <span class="bu">type</span>(x) <span class="op">==</span> <span class="bu">frozenset</span> <span class="kw">and</span> <span class="bu">len</span>(x) <span class="op">==</span> <span class="dv">11</span> <span class="cf">else</span> np.nan</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Putting the away player coordinates into frozensets of (x,y) tuples</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>match_raw[<span class="st">"combinations_away"</span>] <span class="op">=</span> match_raw.<span class="bu">apply</span>(</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> row: <span class="bu">frozenset</span>([(x, y) <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(row[away_x_cols], row[away_y_cols])]),</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing frozensets with less than 11 player coordinates</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>match_raw[<span class="st">"combinations_away"</span>] <span class="op">=</span> match_raw[<span class="st">"combinations_away"</span>].<span class="bu">apply</span>(</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: np.nan <span class="cf">if</span> <span class="bu">any</span>(np.isnan(y) <span class="cf">for</span> tup <span class="kw">in</span> x <span class="cf">for</span> y <span class="kw">in</span> tup) <span class="cf">else</span> x</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Putting the away player coordinates into frozensets of (x,y) tuples</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>match_raw[<span class="st">"combinations_away"</span>] <span class="op">=</span> match_raw[<span class="st">"combinations_away"</span>].<span class="bu">apply</span>(</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: x <span class="cf">if</span> <span class="bu">type</span>(x) <span class="op">==</span> <span class="bu">frozenset</span> <span class="kw">and</span> <span class="bu">len</span>(x) <span class="op">==</span> <span class="dv">11</span> <span class="cf">else</span> np.nan</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="number-of-different-11-player-combinations" class="level5">
<h5 class="anchored" data-anchor-id="number-of-different-11-player-combinations">Number of different 11 player combinations:</h5>
<div class="cell" data-execution_count="14">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>unique_combos <span class="op">=</span> (</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    pd.concat([match_raw[<span class="st">"combinations_home"</span>], match_raw[<span class="st">"combinations_away"</span>]])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    .value_counts()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    .to_frame(name<span class="op">=</span><span class="st">"count"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    .reset_index(names<span class="op">=</span>[<span class="st">"combo"</span>])</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(unique_combos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>37</code></pre>
</div>
</div>
</section>
<section id="combination-distribution-on-the-pitch" class="level5">
<h5 class="anchored" data-anchor-id="combination-distribution-on-the-pitch">Combination distribution on the pitch:</h5>
<div class="cell" data-execution_count="15">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correcting the position of the goal keeper</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>unique_combos[<span class="st">"scaled_combo"</span>] <span class="op">=</span> unique_combos[<span class="st">"combo"</span>].<span class="bu">apply</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="bu">frozenset</span>((<span class="dv">5</span>, <span class="dv">1</span>) <span class="cf">if</span> t <span class="op">==</span> (<span class="dv">1</span>, <span class="dv">1</span>) <span class="cf">else</span> t <span class="cf">for</span> t <span class="kw">in</span> x)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling to the pitch plot</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>pitch_y_offset <span class="op">=</span> <span class="dv">4</span> <span class="op">-</span> dff.scale_num(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">11</span>, <span class="op">-</span><span class="dv">4</span>, <span class="dv">80</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>unique_combos[<span class="st">"scaled_combo"</span>] <span class="op">=</span> unique_combos[<span class="st">"scaled_combo"</span>].<span class="bu">apply</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="bu">frozenset</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            dff.scale_num(t[<span class="dv">0</span>], <span class="dv">1</span>, <span class="dv">11</span>, <span class="dv">0</span>, <span class="dv">80</span>) <span class="op">+</span> pitch_y_offset,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            dff.scale_num(t[<span class="dv">1</span>], <span class="dv">1</span>, <span class="dv">11</span>, <span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> x</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>pitch <span class="op">=</span> Pitch(</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    pitch_color<span class="op">=</span><span class="st">"grass"</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    line_color<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    stripe<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>fig_pitch, ax_pitch <span class="op">=</span> pitch.draw(</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(base_fig_width, base_fig_height)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>ax_pitch <span class="op">=</span> ax_pitch.flatten()</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, combo <span class="kw">in</span> <span class="bu">enumerate</span>(unique_combos[:<span class="dv">4</span>].iterrows()):</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pos <span class="kw">in</span> combo[<span class="dv">1</span>][<span class="st">"scaled_combo"</span>]:</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>        ax_pitch[i].scatter(</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>            pos[<span class="dv">1</span>],</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>            pos[<span class="dv">0</span>],</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>            s<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>sns.color_palette(<span class="st">"deep"</span>)[<span class="dv">0</span>],</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(w_pad<span class="op">=-</span><span class="dv">6</span>)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-pitch" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-pitch-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: The four most popular starting lineup position combinations.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="player-attributes" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="player-attributes"><span class="header-section-number">2.2</span> Player attributes</h3>
<p>The dataset included a variety of numerical and categorical player attributes, this section presents this portion of the data.</p>
<section id="what-is-the-player-rating-and-potential-distribution" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="what-is-the-player-rating-and-potential-distribution"><span class="header-section-number">2.2.1</span> What is the player rating and potential distribution?</h4>
<div class="cell" data-execution_count="16">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetching player attributes with the latest date.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>rating_potential <span class="op">=</span> con.query(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""--sql</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT overall_rating,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="st">    potential</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="st">FROM Player_Attributes p</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="st">    JOIN(</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT player_api_id,</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="st">            MAX(date) AS max_date</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="st">        FROM Player_attributes</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="st">        GROUP BY player_api_id</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="st">    ) sub ON p.player_api_id = sub.player_api_id</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="st">    AND p.date = sub.max_date """</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>).to_df()</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>rating_potential.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>rating_potential <span class="op">=</span> rating_potential.astype(<span class="bu">int</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>fig_player_rating_hist, (</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    ax_player_rating_hist,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    ax_player_potential_hist,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(base_fig_width, base_fig_height))</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>rating_potential.hist(<span class="st">"potential"</span>, ax<span class="op">=</span>ax_player_potential_hist)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>rating_potential.hist(<span class="st">"overall_rating"</span>, ax<span class="op">=</span>ax_player_rating_hist)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>disf.axis_titles(ax_player_potential_hist, xtitle<span class="op">=</span><span class="st">"Player Potential"</span>, ytitle<span class="op">=</span><span class="st">"Count"</span>)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>disf.axis_titles(ax_player_rating_hist, xtitle<span class="op">=</span><span class="st">"Player Overall Rating"</span>, ytitle<span class="op">=</span><span class="st">"Count"</span>)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-player_rating_hist" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-player_rating_hist-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: The distribution of player overall rating and potential. The latest stats of each player is included in this figure.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="whats-is-the-foot-preference-distribution" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="whats-is-the-foot-preference-distribution"><span class="header-section-number">2.2.2</span> Whats is the foot preference distribution?</h4>
<div class="cell" data-execution_count="17">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>con.query(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""--sql</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ss">SELECT </span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ss">    COUNT(*) AS total,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ss">    SUM(CASE WHEN preferred_foot = 'right' THEN 1 ELSE 0 END) AS right_count,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ss">    SUM(CASE WHEN preferred_foot = 'left' THEN 1 ELSE 0 END) AS left_count</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="ss">FROM Player_Attributes p</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    JOIN(</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT player_api_id,</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="ss">            MAX(date) AS max_date</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM Player_attributes</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY player_api_id</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="ss">    ) sub ON p.player_api_id = sub.player_api_id</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="ss">    AND p.date = sub.max_date"""</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>).to_df().astype(<span class="bu">int</span>).rename(</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"total"</span>: <span class="st">"Total"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"right_count"</span>: <span class="st">"Right footed players"</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"left_count"</span>: <span class="st">"Left footed players"</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Total</th>
<th data-quarto-table-cell-role="th">Right footed players</th>
<th data-quarto-table-cell-role="th">Left footed players</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>11064</td>
<td>8373</td>
<td>2687</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="do-right-and-left-footed-players-have-a-different-overall-rating" class="level4" data-number="2.2.3">
<h4 data-number="2.2.3" class="anchored" data-anchor-id="do-right-and-left-footed-players-have-a-different-overall-rating"><span class="header-section-number">2.2.3</span> Do right and left footed players have a different overall rating?</h4>
<section id="fetching-the-data" class="level5">
<h5 class="anchored" data-anchor-id="fetching-the-data">Fetching the data:</h5>
<div class="cell" data-execution_count="18">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>player_f_rating <span class="op">=</span> con.query(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""--sql</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="ss">SELECT  CAST(overall_rating as INT) AS 'Overall Rating', preferred_foot</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="ss">FROM Player_Attributes p</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="ss">    JOIN(</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT player_api_id,</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="ss">            MAX(date) AS max_date</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM Player_attributes</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY player_api_id</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="ss">    ) sub ON p.player_api_id = sub.player_api_id</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="ss">    AND p.date = sub.max_date"""</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>).to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="t-test" class="level5">
<h5 class="anchored" data-anchor-id="t-test">T-test:</h5>
<div class="cell" data-execution_count="19">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>player_f_rating_levresults <span class="op">=</span> stats.levene(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    player_f_rating.loc[player_f_rating[<span class="st">"preferred_foot"</span>] <span class="op">==</span> <span class="st">"right"</span>, <span class="st">"Overall Rating"</span>],</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    player_f_rating.loc[player_f_rating[<span class="st">"preferred_foot"</span>] <span class="op">==</span> <span class="st">"left"</span>, <span class="st">"Overall Rating"</span>],</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>player_f_rating_tresults <span class="op">=</span> stats.ttest_ind(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    player_f_rating.loc[player_f_rating[<span class="st">"preferred_foot"</span>] <span class="op">==</span> <span class="st">"right"</span>, <span class="st">"Overall Rating"</span>],</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    player_f_rating.loc[player_f_rating[<span class="st">"preferred_foot"</span>] <span class="op">==</span> <span class="st">"left"</span>, <span class="st">"Overall Rating"</span>],</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    equal_var<span class="op">=</span>player_f_rating_levresults.pvalue <span class="op">&gt;</span> significance,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>Markdown(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""t-statistic: </span><span class="sc">{</span><span class="bu">round</span>(player_f_rating_tresults.statistic,<span class="dv">2</span>)<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="ss">         p-val: </span><span class="sc">{</span><span class="bu">round</span>(player_f_rating_tresults.pvalue,<span class="dv">2</span>)<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="ss">         There </span><span class="sc">{</span><span class="st">'is a'</span> <span class="cf">if</span> player_f_rating_tresults<span class="sc">.</span>pvalue <span class="op">&lt;</span> significance <span class="cf">else</span> <span class="st">'is no'</span><span class="sc">}</span><span class="ss"> </span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="ss">         significant difference in overall rating between right and left footed players</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="ss">         """</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<p>t-statistic: -0.54<br> p-val: 0.59<br> There is no significant difference in overall rating between right and left footed players</p>
</div>
</div>
</section>
</section>
<section id="what-is-the-distribution-of-goal-keeper-attributes" class="level4" data-number="2.2.4">
<h4 data-number="2.2.4" class="anchored" data-anchor-id="what-is-the-distribution-of-goal-keeper-attributes"><span class="header-section-number">2.2.4</span> What is the distribution of goal keeper attributes?</h4>
<section id="getting-the-histogram-data-for-goal-keeper-diving-ability" class="level5">
<h5 class="anchored" data-anchor-id="getting-the-histogram-data-for-goal-keeper-diving-ability">Getting the histogram data for goal keeper diving ability:</h5>
<div class="cell" data-execution_count="20">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>goaly_hist_df <span class="op">=</span> (</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    con.query(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"""--sql</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ss">WITH bin_stats AS (</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT (</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="ss">            (</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="ss">                MAX(CAST(gk_diving AS INT)) - MIN(CAST(gk_diving AS INT))</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="ss">            ) / 10</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="ss">        ) AS bin_size</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM Player_Attributes p</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN(</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="ss">            SELECT player_api_id,</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="ss">                MAX(date) AS max_date</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="ss">            FROM Player_attributes</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="ss">            GROUP BY player_api_id</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="ss">        ) sub ON p.player_api_id = sub.player_api_id</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="ss">        AND p.date = sub.max_date</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="ss">)</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="ss">SELECT FLOOR(</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="ss">        CAST(gk_diving AS INT) / (</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="ss">            SELECT bin_size</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="ss">            FROM bin_stats</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="ss">        )</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="ss">    ) * (</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT bin_size</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM bin_stats</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="ss">    ) AS bin,</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="ss">    COUNT(*) AS count</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="ss">FROM Player_Attributes p</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="ss">    JOIN(</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT player_api_id,</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="ss">            MAX(date) AS max_date</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM Player_attributes</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY player_api_id</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="ss">    ) sub ON p.player_api_id = sub.player_api_id</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="ss">    AND p.date = sub.max_date</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="ss">GROUP BY bin</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="ss">ORDER BY bin;</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    .to_df()</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    .astype(<span class="bu">int</span>, errors<span class="op">=</span><span class="st">"ignore"</span>)</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plotting-the-frequencies" class="level5">
<h5 class="anchored" data-anchor-id="plotting-the-frequencies">Plotting the frequencies:</h5>
<div class="cell" data-execution_count="21">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig_goaly_stats, ax_goaly_stats <span class="op">=</span> plt.subplots()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    goaly_hist_df, x<span class="op">=</span><span class="st">"bin"</span>, y<span class="op">=</span><span class="st">"count"</span>, ax<span class="op">=</span>ax_goaly_stats, color<span class="op">=</span>sns.color_palette()[<span class="dv">0</span>]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>ax_goaly_stats.set_xticks(np.arange(<span class="dv">0</span>, <span class="dv">10</span>, step<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>ax_goaly_stats.set_xticklabels(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    np.linspace(goaly_hist_df[<span class="st">"bin"</span>].<span class="bu">min</span>(), goaly_hist_df[<span class="st">"bin"</span>].<span class="bu">max</span>(), num<span class="op">=</span><span class="dv">5</span>).astype(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">int</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>ax_goaly_stats.set_yscale(<span class="st">"log"</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>disf.axis_titles(ax<span class="op">=</span>ax_goaly_stats, ytitle<span class="op">=</span><span class="st">"Count"</span>, xtitle<span class="op">=</span><span class="st">"Goal Keeper Diving Rating"</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-goaly_stats" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-goaly_stats-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: The distribution of “Goal keeper diving rating across all players in the data set. The latest entry for each player is taken.”</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The distribution of goalkeeper attributes indicate that there is a split between goalkeepers and regular players.</p>
</section>
</section>
<section id="is-there-a-linear-correlation-between-player-overall-ratings-and-their-other-attributes" class="level4" data-number="2.2.5">
<h4 data-number="2.2.5" class="anchored" data-anchor-id="is-there-a-linear-correlation-between-player-overall-ratings-and-their-other-attributes"><span class="header-section-number">2.2.5</span> Is there a linear correlation between player overall ratings and their other attributes?</h4>
<section id="importing-all-player-attributes" class="level5">
<h5 class="anchored" data-anchor-id="importing-all-player-attributes">Importing all player attributes:</h5>
<div class="cell" data-execution_count="22">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>player_attr_raw <span class="op">=</span> con.query(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""--sql</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="ss">SELECT * FROM Player_Attributes</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>).to_df()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>player_attr_numeric <span class="op">=</span> [</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"overall_rating"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"potential"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"crossing"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"finishing"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"heading_accuracy"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"short_passing"</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"volleys"</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dribbling"</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"curve"</span>,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"free_kick_accuracy"</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"long_passing"</span>,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ball_control"</span>,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"acceleration"</span>,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sprint_speed"</span>,</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"agility"</span>,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"reactions"</span>,</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"balance"</span>,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"shot_power"</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jumping"</span>,</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stamina"</span>,</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"strength"</span>,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"long_shots"</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aggression"</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"interceptions"</span>,</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"positioning"</span>,</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"vision"</span>,</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"penalties"</span>,</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"marking"</span>,</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"standing_tackle"</span>,</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sliding_tackle"</span>,</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gk_diving"</span>,</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gk_handling"</span>,</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gk_kicking"</span>,</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gk_positioning"</span>,</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gk_reflexes"</span>,</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>player_attr_raw[player_attr_numeric] <span class="op">=</span> player_attr_raw[player_attr_numeric].<span class="bu">apply</span>(</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    pd.to_numeric</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>player_attr_raw[<span class="st">"date"</span>] <span class="op">=</span> pd.to_datetime(player_attr_raw[<span class="st">"date"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculating-and-displaying-the-correlations" class="level5">
<h5 class="anchored" data-anchor-id="calculating-and-displaying-the-correlations">Calculating and displaying the correlations:</h5>
<div class="cell" data-execution_count="23">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>player_att_corrs <span class="op">=</span> (</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    player_attr_raw[player_attr_numeric]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    .corr()[<span class="st">"overall_rating"</span>]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    .to_frame()</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    .join(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        player_attr_raw[player_attr_numeric]</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        .loc[player_attr_raw[player_attr_numeric][<span class="st">"gk_diving"</span>] <span class="op">&gt;</span> <span class="dv">50</span>]</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        .corr()[<span class="st">"overall_rating"</span>]</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        .to_frame(),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        rsuffix<span class="op">=</span><span class="st">"_goal_keeper"</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>player_att_corrs.style.background_gradient(<span class="st">"coolwarm"</span>).<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="23">
<style type="text/css">
#T_a873c_row0_col0, #T_a873c_row0_col1 {
  background-color: #b40426;
  color: #f1f1f1;
}
#T_a873c_row1_col0, #T_a873c_row15_col0 {
  background-color: #f29274;
  color: #f1f1f1;
}
#T_a873c_row1_col1 {
  background-color: #eb7d62;
  color: #f1f1f1;
}
#T_a873c_row2_col0, #T_a873c_row8_col0 {
  background-color: #b1cbfc;
  color: #000000;
}
#T_a873c_row2_col1, #T_a873c_row3_col1, #T_a873c_row29_col1 {
  background-color: #3f53c6;
  color: #f1f1f1;
}
#T_a873c_row3_col0, #T_a873c_row19_col0 {
  background-color: #a7c5fe;
  color: #000000;
}
#T_a873c_row4_col0, #T_a873c_row20_col1 {
  background-color: #a2c1ff;
  color: #000000;
}
#T_a873c_row4_col1 {
  background-color: #3d50c3;
  color: #f1f1f1;
}
#T_a873c_row5_col0 {
  background-color: #d1dae9;
  color: #000000;
}
#T_a873c_row5_col1, #T_a873c_row28_col0 {
  background-color: #6e90f2;
  color: #f1f1f1;
}
#T_a873c_row6_col0 {
  background-color: #b2ccfb;
  color: #000000;
}
#T_a873c_row6_col1 {
  background-color: #455cce;
  color: #f1f1f1;
}
#T_a873c_row7_col0 {
  background-color: #afcafc;
  color: #000000;
}
#T_a873c_row7_col1 {
  background-color: #3e51c5;
  color: #f1f1f1;
}
#T_a873c_row8_col1, #T_a873c_row21_col1, #T_a873c_row32_col0 {
  background-color: #4055c8;
  color: #f1f1f1;
}
#T_a873c_row9_col0 {
  background-color: #aec9fc;
  color: #000000;
}
#T_a873c_row9_col1 {
  background-color: #4b64d5;
  color: #f1f1f1;
}
#T_a873c_row10_col0 {
  background-color: #cad8ef;
  color: #000000;
}
#T_a873c_row10_col1 {
  background-color: #7295f4;
  color: #f1f1f1;
}
#T_a873c_row11_col0 {
  background-color: #cdd9ec;
  color: #000000;
}
#T_a873c_row11_col1 {
  background-color: #7093f3;
  color: #f1f1f1;
}
#T_a873c_row12_col0, #T_a873c_row12_col1 {
  background-color: #8badfd;
  color: #000000;
}
#T_a873c_row13_col0 {
  background-color: #8db0fe;
  color: #000000;
}
#T_a873c_row13_col1 {
  background-color: #93b5fe;
  color: #000000;
}
#T_a873c_row14_col0, #T_a873c_row14_col1 {
  background-color: #88abfd;
  color: #000000;
}
#T_a873c_row15_col1 {
  background-color: #f7b599;
  color: #000000;
}
#T_a873c_row16_col0 {
  background-color: #6c8ff1;
  color: #f1f1f1;
}
#T_a873c_row16_col1 {
  background-color: #5d7ce6;
  color: #f1f1f1;
}
#T_a873c_row17_col0 {
  background-color: #c7d7f0;
  color: #000000;
}
#T_a873c_row17_col1, #T_a873c_row29_col0 {
  background-color: #6282ea;
  color: #f1f1f1;
}
#T_a873c_row18_col0 {
  background-color: #8fb1fe;
  color: #000000;
}
#T_a873c_row18_col1, #T_a873c_row25_col0 {
  background-color: #c9d7f0;
  color: #000000;
}
#T_a873c_row19_col1, #T_a873c_row27_col0 {
  background-color: #6384eb;
  color: #f1f1f1;
}
#T_a873c_row20_col0 {
  background-color: #a3c2fe;
  color: #000000;
}
#T_a873c_row21_col0, #T_a873c_row26_col0 {
  background-color: #bcd2f7;
  color: #000000;
}
#T_a873c_row22_col0 {
  background-color: #a6c4fe;
  color: #000000;
}
#T_a873c_row22_col1 {
  background-color: #89acfd;
  color: #000000;
}
#T_a873c_row23_col0 {
  background-color: #8caffe;
  color: #000000;
}
#T_a873c_row23_col1 {
  background-color: #6788ee;
  color: #f1f1f1;
}
#T_a873c_row24_col0 {
  background-color: #b6cefa;
  color: #000000;
}
#T_a873c_row24_col1 {
  background-color: #536edd;
  color: #f1f1f1;
}
#T_a873c_row25_col1 {
  background-color: #86a9fc;
  color: #f1f1f1;
}
#T_a873c_row26_col1 {
  background-color: #779af7;
  color: #f1f1f1;
}
#T_a873c_row27_col1, #T_a873c_row28_col1, #T_a873c_row31_col0, #T_a873c_row33_col0, #T_a873c_row34_col0 {
  background-color: #3b4cc0;
  color: #f1f1f1;
}
#T_a873c_row30_col0 {
  background-color: #4257c9;
  color: #f1f1f1;
}
#T_a873c_row30_col1 {
  background-color: #d1493f;
  color: #f1f1f1;
}
#T_a873c_row31_col1 {
  background-color: #d65244;
  color: #f1f1f1;
}
#T_a873c_row32_col1 {
  background-color: #f7a889;
  color: #000000;
}
#T_a873c_row33_col1 {
  background-color: #d44e41;
  color: #f1f1f1;
}
#T_a873c_row34_col1 {
  background-color: #d24b40;
  color: #f1f1f1;
}
</style>

<div id="tbl-rating_att_corr" class="anchored">
<table id="T_a873c" data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;1: Pearson’s r of overall rating versus other player attributes calculated for all players and goalkeepers separately. The goalkeepers here are defined as having goal keeper diving attribute higher than 50.</caption>
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_a873c_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">overall_rating</th>
<th id="T_a873c_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">overall_rating_goal_keeper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_a873c_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">overall_rating</td>
<td id="T_a873c_row0_col0" class="data row0 col0">1.00</td>
<td id="T_a873c_row0_col1" class="data row0 col1">1.00</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">potential</td>
<td id="T_a873c_row1_col0" class="data row1 col0">0.77</td>
<td id="T_a873c_row1_col1" class="data row1 col1">0.80</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">crossing</td>
<td id="T_a873c_row2_col0" class="data row2 col0">0.36</td>
<td id="T_a873c_row2_col1" class="data row2 col1">-0.03</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">finishing</td>
<td id="T_a873c_row3_col0" class="data row3 col0">0.33</td>
<td id="T_a873c_row3_col1" class="data row3 col1">-0.03</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">heading_accuracy</td>
<td id="T_a873c_row4_col0" class="data row4 col0">0.31</td>
<td id="T_a873c_row4_col1" class="data row4 col1">-0.04</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">short_passing</td>
<td id="T_a873c_row5_col0" class="data row5 col0">0.46</td>
<td id="T_a873c_row5_col1" class="data row5 col1">0.12</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">volleys</td>
<td id="T_a873c_row6_col0" class="data row6 col0">0.36</td>
<td id="T_a873c_row6_col1" class="data row6 col1">-0.01</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">dribbling</td>
<td id="T_a873c_row7_col0" class="data row7 col0">0.35</td>
<td id="T_a873c_row7_col1" class="data row7 col1">-0.03</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">curve</td>
<td id="T_a873c_row8_col0" class="data row8 col0">0.36</td>
<td id="T_a873c_row8_col1" class="data row8 col1">-0.03</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row9" class="row_heading level0 row9" data-quarto-table-cell-role="th">free_kick_accuracy</td>
<td id="T_a873c_row9_col0" class="data row9 col0">0.35</td>
<td id="T_a873c_row9_col1" class="data row9 col1">0.01</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row10" class="row_heading level0 row10" data-quarto-table-cell-role="th">long_passing</td>
<td id="T_a873c_row10_col0" class="data row10 col0">0.44</td>
<td id="T_a873c_row10_col1" class="data row10 col1">0.13</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row11" class="row_heading level0 row11" data-quarto-table-cell-role="th">ball_control</td>
<td id="T_a873c_row11_col0" class="data row11 col0">0.44</td>
<td id="T_a873c_row11_col1" class="data row11 col1">0.13</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row12" class="row_heading level0 row12" data-quarto-table-cell-role="th">acceleration</td>
<td id="T_a873c_row12_col0" class="data row12 col0">0.25</td>
<td id="T_a873c_row12_col1" class="data row12 col1">0.21</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row13" class="row_heading level0 row13" data-quarto-table-cell-role="th">sprint_speed</td>
<td id="T_a873c_row13_col0" class="data row13 col0">0.25</td>
<td id="T_a873c_row13_col1" class="data row13 col1">0.23</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row14" class="row_heading level0 row14" data-quarto-table-cell-role="th">agility</td>
<td id="T_a873c_row14_col0" class="data row14 col0">0.24</td>
<td id="T_a873c_row14_col1" class="data row14 col1">0.20</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row15" class="row_heading level0 row15" data-quarto-table-cell-role="th">reactions</td>
<td id="T_a873c_row15_col0" class="data row15 col0">0.77</td>
<td id="T_a873c_row15_col1" class="data row15 col1">0.66</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row16" class="row_heading level0 row16" data-quarto-table-cell-role="th">balance</td>
<td id="T_a873c_row16_col0" class="data row16 col0">0.16</td>
<td id="T_a873c_row16_col1" class="data row16 col1">0.07</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row17" class="row_heading level0 row17" data-quarto-table-cell-role="th">shot_power</td>
<td id="T_a873c_row17_col0" class="data row17 col0">0.43</td>
<td id="T_a873c_row17_col1" class="data row17 col1">0.08</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row18" class="row_heading level0 row18" data-quarto-table-cell-role="th">jumping</td>
<td id="T_a873c_row18_col0" class="data row18 col0">0.26</td>
<td id="T_a873c_row18_col1" class="data row18 col1">0.40</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row19" class="row_heading level0 row19" data-quarto-table-cell-role="th">stamina</td>
<td id="T_a873c_row19_col0" class="data row19 col0">0.33</td>
<td id="T_a873c_row19_col1" class="data row19 col1">0.09</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row20" class="row_heading level0 row20" data-quarto-table-cell-role="th">strength</td>
<td id="T_a873c_row20_col0" class="data row20 col0">0.32</td>
<td id="T_a873c_row20_col1" class="data row20 col1">0.28</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row21" class="row_heading level0 row21" data-quarto-table-cell-role="th">long_shots</td>
<td id="T_a873c_row21_col0" class="data row21 col0">0.39</td>
<td id="T_a873c_row21_col1" class="data row21 col1">-0.03</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row22" class="row_heading level0 row22" data-quarto-table-cell-role="th">aggression</td>
<td id="T_a873c_row22_col0" class="data row22 col0">0.32</td>
<td id="T_a873c_row22_col1" class="data row22 col1">0.20</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row23" class="row_heading level0 row23" data-quarto-table-cell-role="th">interceptions</td>
<td id="T_a873c_row23_col0" class="data row23 col0">0.25</td>
<td id="T_a873c_row23_col1" class="data row23 col1">0.10</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row24" class="row_heading level0 row24" data-quarto-table-cell-role="th">positioning</td>
<td id="T_a873c_row24_col0" class="data row24 col0">0.37</td>
<td id="T_a873c_row24_col1" class="data row24 col1">0.03</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row25" class="row_heading level0 row25" data-quarto-table-cell-role="th">vision</td>
<td id="T_a873c_row25_col0" class="data row25 col0">0.43</td>
<td id="T_a873c_row25_col1" class="data row25 col1">0.20</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row26" class="row_heading level0 row26" data-quarto-table-cell-role="th">penalties</td>
<td id="T_a873c_row26_col0" class="data row26 col0">0.39</td>
<td id="T_a873c_row26_col1" class="data row26 col1">0.15</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row27" class="row_heading level0 row27" data-quarto-table-cell-role="th">marking</td>
<td id="T_a873c_row27_col0" class="data row27 col0">0.13</td>
<td id="T_a873c_row27_col1" class="data row27 col1">-0.05</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row28" class="row_heading level0 row28" data-quarto-table-cell-role="th">standing_tackle</td>
<td id="T_a873c_row28_col0" class="data row28 col0">0.17</td>
<td id="T_a873c_row28_col1" class="data row28 col1">-0.04</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row29" class="row_heading level0 row29" data-quarto-table-cell-role="th">sliding_tackle</td>
<td id="T_a873c_row29_col0" class="data row29 col0">0.13</td>
<td id="T_a873c_row29_col1" class="data row29 col1">-0.03</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row30" class="row_heading level0 row30" data-quarto-table-cell-role="th">gk_diving</td>
<td id="T_a873c_row30_col0" class="data row30 col0">0.03</td>
<td id="T_a873c_row30_col1" class="data row30 col1">0.91</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row31" class="row_heading level0 row31" data-quarto-table-cell-role="th">gk_handling</td>
<td id="T_a873c_row31_col0" class="data row31 col0">0.00</td>
<td id="T_a873c_row31_col1" class="data row31 col1">0.89</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row32" class="row_heading level0 row32" data-quarto-table-cell-role="th">gk_kicking</td>
<td id="T_a873c_row32_col0" class="data row32 col0">0.03</td>
<td id="T_a873c_row32_col1" class="data row32 col1">0.70</td>
</tr>
<tr class="even">
<td id="T_a873c_level0_row33" class="row_heading level0 row33" data-quarto-table-cell-role="th">gk_positioning</td>
<td id="T_a873c_row33_col0" class="data row33 col0">0.01</td>
<td id="T_a873c_row33_col1" class="data row33 col1">0.90</td>
</tr>
<tr class="odd">
<td id="T_a873c_level0_row34" class="row_heading level0 row34" data-quarto-table-cell-role="th">gk_reflexes</td>
<td id="T_a873c_row34_col0" class="data row34 col0">0.01</td>
<td id="T_a873c_row34_col1" class="data row34 col1">0.91</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>As seen in table <a href="#tbl-rating_att_corr">Table&nbsp;1</a>, For all players there are moderate linear correlations between player overall ratings and all attributes except those related to goal keeping. It is the opposite for dedicated goalkeepers.</p>
</section>
</section>
<section id="whats-the-distribution-of-attacking-and-defensive-work" class="level4" data-number="2.2.6">
<h4 data-number="2.2.6" class="anchored" data-anchor-id="whats-the-distribution-of-attacking-and-defensive-work"><span class="header-section-number">2.2.6</span> Whats the distribution of attacking and defensive work?</h4>
<section id="fetching-the-data-1" class="level5">
<h5 class="anchored" data-anchor-id="fetching-the-data-1">Fetching the data:</h5>
<div class="cell" data-execution_count="24">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>att_def_df <span class="op">=</span> con.query(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""--sql</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ss">SELECT attacking_work_rate, defensive_work_rate</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ss">FROM Player_Attributes p</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="ss">    JOIN(</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT player_api_id,</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="ss">            MAX(date) AS max_date</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM Player_attributes</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY player_api_id</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="ss">    ) sub ON p.player_api_id = sub.player_api_id</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="ss">    AND p.date = sub.max_date"""</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>).to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot-2" class="level5">
<h5 class="anchored" data-anchor-id="plot-2">Plot:</h5>
<div class="cell" data-execution_count="25">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fig_att_def, ax_att_def <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(base_fig_width, base_fig_height))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    pd.crosstab(att_def_df[<span class="st">"attacking_work_rate"</span>], att_def_df[<span class="st">"defensive_work_rate"</span>])[</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"high"</span>, <span class="st">"medium"</span>, <span class="st">"low"</span>]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    ].loc[[<span class="st">"high"</span>, <span class="st">"medium"</span>, <span class="st">"low"</span>]],</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">=</span><span class="st">".0f"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax_att_def,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>disf.axis_titles(</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax_att_def, xtitle<span class="op">=</span><span class="st">"Defensive Work Rate"</span>, ytitle<span class="op">=</span><span class="st">"Attacking Work Rate"</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-att_def" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-att_def-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: A heatmap of defensive and attacking work rate of all players. The latest entries for each player were taken.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The majority of players have both medium attacking and defensive work rates.</p>
</section>
</section>
</section>
<section id="team-attributes" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="team-attributes"><span class="header-section-number">2.3</span> Team Attributes</h3>
<p>This section explores the attributes of individual teams that were given in the data set.</p>
<section id="fetching-the-team-attributes" class="level5">
<h5 class="anchored" data-anchor-id="fetching-the-team-attributes">Fetching the team attributes:</h5>
<div class="cell" data-execution_count="26">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>team_attr_raw <span class="op">=</span> con.query(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""--sql</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="ss">SELECT *</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ss">FROM Team_Attributes</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>).to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="what-is-the-distribution-of-team-attributes" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="what-is-the-distribution-of-team-attributes"><span class="header-section-number">2.3.1</span> What is the distribution of Team attributes?</h4>
<section id="making-a-list-of-numeric-attributes-and-fixing-data-types" class="level5">
<h5 class="anchored" data-anchor-id="making-a-list-of-numeric-attributes-and-fixing-data-types">Making a list of numeric attributes and fixing data types:</h5>
<div class="cell" data-execution_count="27">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>team_numeric_cols <span class="op">=</span> [</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"buildUpPlaySpeed"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"buildUpPlayDribbling"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"buildUpPlayPassing"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chanceCreationPassing"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chanceCreationCrossing"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chanceCreationShooting"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"defencePressure"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"defenceAggression"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"defenceTeamWidth"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>team_categoric_cols <span class="op">=</span> [col <span class="op">+</span> <span class="st">"Class"</span> <span class="cf">for</span> col <span class="kw">in</span> team_numeric_cols]</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>team_attr_raw[team_numeric_cols] <span class="op">=</span> team_attr_raw[team_numeric_cols].<span class="bu">apply</span>(</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    pd.to_numeric, errors<span class="op">=</span><span class="st">"coerce"</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>team_attr_raw[<span class="st">"date"</span>] <span class="op">=</span> pd.to_datetime(team_attr_raw[<span class="st">"date"</span>])</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>team_attr_raw.set_index(<span class="st">"id"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>latest_team_attr <span class="op">=</span> team_attr_raw.loc[team_attr_raw.groupby(<span class="st">"team_api_id"</span>).date.idxmax()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plotting-numeric-attributes-and-their-categories" class="level5">
<h5 class="anchored" data-anchor-id="plotting-numeric-attributes-and-their-categories">Plotting numeric attributes and their categories:</h5>
<div class="cell" data-execution_count="28">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig_team_attr, ax_team_attr <span class="op">=</span> plt.subplots(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(base_fig_width, base_fig_height <span class="op">*</span> <span class="dv">4</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>ax_team_attr <span class="op">=</span> ax_team_attr.flatten()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, attr <span class="kw">in</span> <span class="bu">enumerate</span>(team_numeric_cols):</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    sns.histplot(latest_team_attr, x<span class="op">=</span>attr, hue<span class="op">=</span>attr <span class="op">+</span> <span class="st">"Class"</span>, ax<span class="op">=</span>ax_team_attr[i])</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    ax_team_attr[i].get_legend().set_title(<span class="st">""</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>fig_team_attr.delaxes(ax_team_attr[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(h_pad<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-team_attr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-team_attr-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Histograms of numeric team attributes. Categories for the same characteristics are also given in the data set, therefore the histograms are split according to those categories.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-non-numeric-attributes" class="level5">
<h5 class="anchored" data-anchor-id="plotting-non-numeric-attributes">Plotting non numeric attributes:</h5>
<div class="cell" data-execution_count="29">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>team_attr_non_numeric <span class="op">=</span> [</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"buildUpPlayPositioningClass"</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chanceCreationPositioningClass"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"defenceDefenderLineClass"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>fig_team_attr_cat, ax_team_attr_cat <span class="op">=</span> plt.subplots(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(base_fig_width, base_fig_height)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>ax_team_attr_cat <span class="op">=</span> ax_team_attr_cat.flatten()</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, attr <span class="kw">in</span> <span class="bu">enumerate</span>(team_attr_non_numeric):</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>latest_team_attr, x<span class="op">=</span>attr, ax<span class="op">=</span>ax_team_attr_cat[i])</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    ax_team_attr_cat[i].set_xlabel(attr[:<span class="op">-</span><span class="dv">5</span>])</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(w_pad<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-team_attr_cat" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-team_attr_cat-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;8: The distribution of categorical attributes amongst teams.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Team attributes that can be described numerically are given in both numeric and three-category formats as can be seen in <a href="#fig-team_attr">Figure&nbsp;7</a>. Three boolean attributes were also given as seen in <a href="#fig-team_attr_cat">Figure&nbsp;8</a>.</p>
</section>
</section>
<section id="do-the-numeric-team-attributes-correlate-linearly-with-each-other" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="do-the-numeric-team-attributes-correlate-linearly-with-each-other"><span class="header-section-number">2.3.2</span> Do the numeric team attributes correlate linearly with each other?</h4>
<div class="cell" data-execution_count="30">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>disf.get_correlation_pairs(latest_team_attr, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.3</span>).rename(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"r-value"</span>: <span class="st">"Pearson's r"</span>, <span class="st">"feature_pair"</span>: <span class="st">"Feature pair"</span>}, axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Pearson's r</th>
<th data-quarto-table-cell-role="th">Feature pair</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.327754</td>
<td>(buildUpPlaySpeed, chanceCreationPassing)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0.466181</td>
<td>(defenceAggression, defencePressure)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0.363279</td>
<td>(defenceTeamWidth, defencePressure)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Certain defensive attributes seem to have a moderate linear correlation with each other, as well as build up play speed and chance creation passing attributes.</p>
</section>
</section>
</section>
<section id="feature-selection" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="feature-selection"><span class="header-section-number">3</span> Feature selection</h2>
<p>This section delves into the feature selection process for the final logistic regression model, aimed at predicting whether the home team wins the match. The primary focus of the model lies in achieving high predictive power. As a result, the feature selection heavily relies on the predictive capabilities of different feature sets.</p>
<section id="starting-line-up-combinations" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="starting-line-up-combinations"><span class="header-section-number">3.1</span> Starting line-up combinations</h3>
<p>Making a copy the match DataFrame with only relevant information:</p>
<div class="cell" data-execution_count="31">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>match_win_df <span class="op">=</span> match_raw[</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_id"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"home_team_api_id"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"away_team_api_id"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"home_team_goal"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"away_team_goal"</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>match_win_df[<span class="st">"home_team_win"</span>] <span class="op">=</span> match_win_df.<span class="bu">apply</span>(</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x[<span class="st">"home_team_goal"</span>] <span class="op">&gt;</span> x[<span class="st">"away_team_goal"</span>] <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="do-combinations-influence-the-match-outcome" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="do-combinations-influence-the-match-outcome"><span class="header-section-number">3.1.1</span> Do combinations influence the match outcome?</h4>
<section id="adding-the-combination-data" class="level5">
<h5 class="anchored" data-anchor-id="adding-the-combination-data">Adding the combination data:</h5>
<div class="cell" data-execution_count="32">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number labels for unique combinations</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>combo_dict <span class="op">=</span> unique_combos[<span class="st">"combo"</span>].to_dict()</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>combo_dict <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> combo_dict.items()}</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the combinations from the raw data</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>match_win_df_combo <span class="op">=</span> pd.merge(</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    match_win_df,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    match_raw[[<span class="st">"combinations_home"</span>, <span class="st">"combinations_away"</span>]],</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    left_index<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    right_index<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing the combinations into a single number label</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>match_win_df_combo[[<span class="st">"combinations_home"</span>, <span class="st">"combinations_away"</span>]] <span class="op">=</span> match_win_df_combo[</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"combinations_home"</span>, <span class="st">"combinations_away"</span>]</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>].replace(combo_dict)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Making a column with the home away combination pairs</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>match_win_df_combo[<span class="st">"combo_home_away"</span>] <span class="op">=</span> match_win_df_combo.<span class="bu">apply</span>(</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: (x[<span class="st">"combinations_home"</span>], x[<span class="st">"combinations_away"</span>]), axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>match_win_df_combo[<span class="st">"combo_home_away"</span>] <span class="op">=</span> match_win_df_combo[<span class="st">"combo_home_away"</span>].<span class="bu">apply</span>(</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: np.nan <span class="cf">if</span> np.isnan(x).<span class="bu">any</span>() <span class="cf">else</span> x</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="chi-squared-test-with-the-null-hypothesis-that-home-team-combination-top-5-combinations-only-is-not-associated-to-home-the-home-team-winning" class="level5">
<h5 class="anchored" data-anchor-id="chi-squared-test-with-the-null-hypothesis-that-home-team-combination-top-5-combinations-only-is-not-associated-to-home-the-home-team-winning">Chi-squared test with the null hypothesis that home team combination (top 5 combinations only) is not associated to home the home team winning:</h5>
<div class="cell" data-execution_count="33">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>comb_h_home_w_con_tab <span class="op">=</span> pd.crosstab(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    match_win_df_combo.loc[</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>        match_win_df_combo[<span class="st">"combinations_home"</span>] <span class="op">&lt;=</span> <span class="dv">5</span>, <span class="st">"home_team_win"</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    match_win_df_combo.loc[</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        match_win_df_combo[<span class="st">"combinations_home"</span>] <span class="op">&lt;=</span> <span class="dv">5</span>, <span class="st">"combinations_home"</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>comb_h_home_w_results <span class="op">=</span> stats.chi2_contingency(comb_h_home_w_con_tab)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>Markdown(</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""Chi-squared statistic: </span><span class="sc">{</span><span class="bu">round</span>(comb_h_home_w_results.statistic,<span class="dv">1</span>)<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="ss">         p-value: </span><span class="sc">{</span>comb_h_home_w_results<span class="sc">.</span>pvalue<span class="sc">:.2e}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="ss">         The home team combination </span><span class="sc">{</span><span class="st">'is'</span> <span class="cf">if</span> comb_h_home_w_results<span class="sc">.</span>pvalue<span class="op">&lt;</span>significance <span class="cf">else</span> <span class="st">'is not'</span><span class="sc">}</span><span class="ss"> </span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="ss">         significantly associated with the home team winning.</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="ss">         """</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="33">
<p>Chi-squared statistic: 50.8<br> p-value: 9.40e-10<br> The home team combination is significantly associated with the home team winning.</p>
</div>
</div>
</section>
<section id="chi-squared-test-with-the-null-hypothesis-that-away-team-combination-top-5-combinations-only-is-not-associated-to-home-the-home-team-winning" class="level5">
<h5 class="anchored" data-anchor-id="chi-squared-test-with-the-null-hypothesis-that-away-team-combination-top-5-combinations-only-is-not-associated-to-home-the-home-team-winning">Chi-squared test with the null hypothesis that away team combination (top 5 combinations only) is not associated to home the home team winning:</h5>
<div class="cell" data-execution_count="34">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>comb_a_home_w_con_tab <span class="op">=</span> pd.crosstab(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    match_win_df_combo.loc[</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>        match_win_df_combo[<span class="st">"combinations_away"</span>] <span class="op">&lt;=</span> <span class="dv">5</span>, <span class="st">"home_team_win"</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    match_win_df_combo.loc[</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        match_win_df_combo[<span class="st">"combinations_away"</span>] <span class="op">&lt;=</span> <span class="dv">5</span>, <span class="st">"combinations_away"</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>comb_a_home_w_results <span class="op">=</span> stats.chi2_contingency(comb_a_home_w_con_tab)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>Markdown(</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""Chi-squared statistic: </span><span class="sc">{</span><span class="bu">round</span>(comb_a_home_w_results.statistic,<span class="dv">1</span>)<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="ss">         p-value: </span><span class="sc">{</span>comb_a_home_w_results<span class="sc">.</span>pvalue<span class="sc">:.2e}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="ss">         The home team combination </span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="ss">         </span><span class="sc">{</span><span class="st">'is'</span> <span class="cf">if</span> comb_a_home_w_results<span class="sc">.</span>pvalue <span class="op">&lt;</span> significance <span class="cf">else</span> <span class="st">'is not'</span><span class="sc">}</span><span class="ss"> </span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="ss">         significantly associated with the home team winning.</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="ss">         """</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">
<p>Chi-squared statistic: 27.1<br> p-value: 5.55e-05<br> The home team combination is significantly associated with the home team winning.</p>
</div>
</div>
</section>
<section id="chi-squared-test-with-the-null-hypothesis-that-home-away-team-combination-pair-is-not-associated-to-home-the-home-team-winning" class="level5">
<h5 class="anchored" data-anchor-id="chi-squared-test-with-the-null-hypothesis-that-home-away-team-combination-pair-is-not-associated-to-home-the-home-team-winning">Chi-squared test with the null hypothesis that home-away team combination pair is not associated to home the home team winning:</h5>
<div class="cell" data-execution_count="35">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>comb_ha_home_w_con_tab <span class="op">=</span> pd.crosstab(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    match_win_df_combo[<span class="st">"combo_home_away"</span>].<span class="bu">apply</span>(<span class="bu">str</span>),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    match_win_df_combo[<span class="st">"home_team_win"</span>],</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>comb_ha_home_w_results <span class="op">=</span> stats.chi2_contingency(comb_ha_home_w_con_tab)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>Markdown(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""Chi-squared statistic: </span><span class="sc">{</span><span class="bu">round</span>(comb_ha_home_w_results.statistic,<span class="dv">1</span>)<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="ss">         p-value: </span><span class="sc">{</span>comb_ha_home_w_results<span class="sc">.</span>pvalue<span class="sc">:.2e}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="ss">         The home-away team combination pair </span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="ss">         </span><span class="sc">{</span><span class="st">'is'</span> <span class="cf">if</span> comb_ha_home_w_results<span class="sc">.</span>pvalue<span class="op">&lt;</span>significance <span class="cf">else</span> <span class="st">'is not'</span><span class="sc">}</span><span class="ss"> </span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="ss">         significantly associated with the home team winning.</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="ss">         """</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="35">
<p>Chi-squared statistic: 756.2<br> p-value: 3.67e-05<br> The home-away team combination pair is significantly associated with the home team winning.</p>
</div>
</div>
</section>
<section id="home-team-combination-match-outcome-heatmap" class="level5">
<h5 class="anchored" data-anchor-id="home-team-combination-match-outcome-heatmap">Home team combination-match outcome heatmap:</h5>
<div class="cell" data-execution_count="36">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fig_combo_contingency, ax_combo_contingency <span class="op">=</span> plt.subplots(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(base_fig_width, base_fig_height)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    comb_h_home_w_con_tab.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.div(x.<span class="bu">sum</span>(), axis<span class="op">=</span><span class="dv">0</span>)),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">=</span><span class="st">".0%"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax_combo_contingency,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>disf.axis_titles(</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax_combo_contingency, xtitle<span class="op">=</span><span class="st">"Home Team Combination"</span>, ytitle<span class="op">=</span><span class="st">"Home Team Win"</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>ax_combo_contingency.set_xticklabels(np.arange(<span class="dv">0</span>,<span class="dv">6</span>))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>ax_combo_contingency.set_yticklabels([<span class="st">"Loss/Tie"</span>, <span class="st">"Win"</span>])</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-combo_heatmap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-combo_heatmap-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9: Heatmap of six most popular home team starting lineup combinations versus match outcome.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>From the statistical analysis we can say that the starting lineup combinations do influence the match outcome. An example of this is illustrated in <a href="#fig-combo_heatmap">Figure&nbsp;9</a>, where it can be seen that certain combinations such as combination 2 have a higher win percentage than others such as combination 5.</p>
</section>
</section>
<section id="can-the-combinations-be-used-to-predict-match-outcome" class="level4" data-number="3.1.2">
<h4 data-number="3.1.2" class="anchored" data-anchor-id="can-the-combinations-be-used-to-predict-match-outcome"><span class="header-section-number">3.1.2</span> Can the combinations be used to predict match outcome?</h4>
<p>Due to the categoric nature of the combination data and the number of different categories the random forest model was chosen to test the predictive power of this feature set. The Model is built by using both home team and away team starting lineup combinations.</p>
<section id="building-the-random-forest-model-and-making-predictions" class="level5">
<h5 class="anchored" data-anchor-id="building-the-random-forest-model-and-making-predictions">Building the random forest model and making predictions:</h5>
<div class="cell" data-execution_count="37">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>match_win_df_combo.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>home_win_target <span class="op">=</span> match_win_df_combo[<span class="st">"home_team_win"</span>]</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>home_win_team_features <span class="op">=</span> match_win_df_combo[[<span class="st">"combinations_home"</span>, <span class="st">"combinations_away"</span>]]</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    home_win_team_features, home_win_target, test_size<span class="op">=</span><span class="fl">0.33</span>, random_state<span class="op">=</span><span class="dv">1</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> RandomForestClassifier()</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> logit_model.fit(X_train, y_train)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> result.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="classification-report" class="level5">
<h5 class="anchored" data-anchor-id="classification-report">Classification report:</h5>
<div class="cell" data-execution_count="38">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predictions.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.55      0.82      0.66      4360
           1       0.48      0.20      0.29      3607

    accuracy                           0.54      7967
   macro avg       0.52      0.51      0.47      7967
weighted avg       0.52      0.54      0.49      7967
</code></pre>
</div>
</div>
</section>
<section id="outcome-skew-in-the-test-set" class="level5">
<h5 class="anchored" data-anchor-id="outcome-skew-in-the-test-set">Outcome skew in the test set:</h5>
<div class="cell" data-execution_count="39">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>y_test.value_counts(normalize<span class="op">=</span><span class="va">True</span>).to_frame(name<span class="op">=</span><span class="st">"Fraction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Fraction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.547257</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.452743</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="receiver-operating-characteristic-curve" class="level5">
<h5 class="anchored" data-anchor-id="receiver-operating-characteristic-curve">Receiver operating characteristic curve:</h5>
<div class="cell" data-execution_count="40">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_test, predictions.<span class="bu">round</span>())</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>auc_score <span class="op">=</span> roc_auc_score(y_test, predictions.<span class="bu">round</span>())</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>fig_combo_roc, ax_combo_roc <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(base_fig_width, base_fig_height))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>ax_combo_roc.plot(fpr, tpr, label<span class="op">=</span><span class="st">"ROC curve (AUC = </span><span class="sc">%0.2f</span><span class="st">)"</span> <span class="op">%</span> auc_score)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>ax_combo_roc.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"k--"</span>)  <span class="co"># Random guessing line</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>ax_combo_roc.set_xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>ax_combo_roc.set_ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>ax_combo_roc.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-combo_roc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-combo_roc-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;10: Receiver operating characteristic curve of the home-win predictions made by the random forest model trained on team starting lineup combinations.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The random forest model based on the home team and away team starting line-up combinations predicted the game outcome with 54% accuracy. This value does not be the underlying outcome data skew and barely beats random guessing as seen from the ROC curve (<a href="#fig-combo_roc">Figure&nbsp;10</a>) therefore these features are not included in the final model.</p>
</section>
</section>
</section>
<section id="team-attributes-1" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="team-attributes-1"><span class="header-section-number">3.2</span> Team Attributes</h3>
<section id="preparing-the-features" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="preparing-the-features"><span class="header-section-number">3.2.1</span> Preparing the features</h4>
<p>In the dataset, team attributes have undergone multiple updates over time, likely derived from the respective teams’ performances in various matches, possibly even including the matches contained within this dataset. Consequently, we must exercise caution not to incorporate attributes updated after each match occurrence, as doing so could introduce match outcome leakage into our feature set, which can significantly bias the model and compromise its ability to generalize to new, unseen data. To ensure the integrity and validity of our predictive model, we must strictly adhere to using only those team attributes that were available up until the time of each match without incorporating any post-match updates.</p>
<section id="importing-team-attributes-into-a-dataframe" class="level5">
<h5 class="anchored" data-anchor-id="importing-team-attributes-into-a-dataframe">Importing team attributes into a dataframe:</h5>
<div class="cell" data-execution_count="41">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>team_attr_raw <span class="op">=</span> con.query(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""--sql</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT *</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="st">FROM Team_attributes</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>).to_df()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>team_attr_raw[<span class="st">"date"</span>] <span class="op">=</span> pd.to_datetime(team_attr_raw[<span class="st">"date"</span>])</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>team_attr_raw[team_numeric_cols] <span class="op">=</span> team_attr_raw[team_numeric_cols].<span class="bu">apply</span>(pd.to_numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="creating-team-class-objects-for-each-team" class="level5">
<h5 class="anchored" data-anchor-id="creating-team-class-objects-for-each-team">Creating Team class objects for each team:</h5>
<div class="cell" data-execution_count="42">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>unique_team_ids <span class="op">=</span> [</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    i[<span class="dv">0</span>]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> con.query(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""--sql</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT DISTINCT team_api_id</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="st">FROM Team_attributes</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    ).fetchall()</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>teams <span class="op">=</span> {}</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> team <span class="kw">in</span> unique_team_ids:</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    teams[team] <span class="op">=</span> Team(team)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    teams[team].get_data(team_attr_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="removing-matches-with-teams-that-have-no-attributes" class="level5">
<h5 class="anchored" data-anchor-id="removing-matches-with-teams-that-have-no-attributes">Removing matches with teams that have no attributes:</h5>
<div class="cell" data-execution_count="43">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>match_win_df_team <span class="op">=</span> match_win_df[</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    match_win_df.index.isin(match_win_df_combo.index)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>]  <span class="co"># not using rows with missing combination data</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>match_win_df_team <span class="op">=</span> match_win_df[</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>match_win_df[<span class="st">"away_team_api_id"</span>].isin(</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">set</span>(unique_team_ids).symmetric_difference(</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>            match_win_df[<span class="st">"away_team_api_id"</span>].unique()</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>match_win_df_team <span class="op">=</span> match_win_df_team[</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>match_win_df_team[<span class="st">"home_team_api_id"</span>].isin(</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">set</span>(unique_team_ids).symmetric_difference(</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>            match_win_df_team[<span class="st">"home_team_api_id"</span>].unique()</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="getting-the-latest-team-attributes-by-match-date-using-the-team-class" class="level5">
<h5 class="anchored" data-anchor-id="getting-the-latest-team-attributes-by-match-date-using-the-team-class">Getting the latest team attributes by match date using the Team class:</h5>
<div class="cell" data-execution_count="44">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>team_attributes_home <span class="op">=</span> {}</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index <span class="kw">in</span> match_win_df_team.index:</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    team_attributes_home[index] <span class="op">=</span> teams[</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        match_win_df_team.at[index, <span class="st">"home_team_api_id"</span>]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    ].get_latest_entry(match_win_df_team.loc[index, <span class="st">"date"</span>], team_numeric_cols)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>team_attributes_away <span class="op">=</span> {}</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index <span class="kw">in</span> match_win_df_team.index:</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    team_attributes_away[index] <span class="op">=</span> teams[</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>        match_win_df_team.at[index, <span class="st">"away_team_api_id"</span>]</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    ].get_latest_entry(match_win_df_team.loc[index, <span class="st">"date"</span>], team_numeric_cols)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>match_win_df_team <span class="op">=</span> match_win_df_team.join(</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    pd.concat(</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">list</span>(team_attributes_home.values()), keys<span class="op">=</span>team_attributes_home.keys()</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    ).droplevel(<span class="dv">1</span>),</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    rsuffix<span class="op">=</span><span class="st">"_home"</span>,</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>match_win_df_team <span class="op">=</span> match_win_df_team.join(</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    pd.concat(</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">list</span>(team_attributes_away.values()), keys<span class="op">=</span>team_attributes_away.keys()</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    ).droplevel(<span class="dv">1</span>),</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    rsuffix<span class="op">=</span><span class="st">"_away"</span>,</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="dropping-matches-where-teams-do-not-have-date-relevant-attributes" class="level5">
<h5 class="anchored" data-anchor-id="dropping-matches-where-teams-do-not-have-date-relevant-attributes">Dropping matches where teams do not have date relevant attributes:</h5>
<div class="cell" data-execution_count="45">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>match_win_df_team.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="number-of-matches-left" class="level5">
<h5 class="anchored" data-anchor-id="number-of-matches-left">Number of matches left:</h5>
<div class="cell" data-execution_count="46">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(match_win_df_team)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>5562</code></pre>
</div>
</div>
</section>
<section id="lineup-combination-summary" class="level5">
<h5 class="anchored" data-anchor-id="lineup-combination-summary">Lineup combination summary</h5>
<p>A custom class object called “Team” has been developed, wherein a new instance of the Team class is created for each team in the dataset. This class effectively stores all attribute entries associated with a specific team. Additionally, the class includes a method that, given a specific date and a list of columns, enables retrieval of the latest features that were entered before the specified date.</p>
<p>Using this Team class, relevant date-specific attributes for both the home and away teams were incorporated for each match in the dataset. However, Only five and a half thousand matches out of the total dataset had date-relevant team attributes.</p>
</section>
</section>
<section id="logistic-regression-with-all-home-and-away-team-attributes" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="logistic-regression-with-all-home-and-away-team-attributes"><span class="header-section-number">3.2.2</span> Logistic regression with all home and away team attributes</h4>
<section id="model-training-and-prediction" class="level5">
<h5 class="anchored" data-anchor-id="model-training-and-prediction">Model training and prediction:</h5>
<div class="cell" data-execution_count="47">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cols_to_drop <span class="op">=</span> [</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"date"</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"country_id"</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"home_team_api_id"</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"away_team_api_id"</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"home_team_goal"</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"away_team_goal"</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"home_team_win"</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>home_win_target_team <span class="op">=</span> match_win_df_team[<span class="st">"home_team_win"</span>]</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>home_win_team_features <span class="op">=</span> match_win_df_team.drop(columns<span class="op">=</span>cols_to_drop)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    home_win_team_features, home_win_target_team, test_size<span class="op">=</span><span class="fl">0.33</span>, random_state<span class="op">=</span><span class="dv">1</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling the data</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>team_feat_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> team_feat_scaler.fit_transform(X_train)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> team_feat_scaler.fit_transform(X_test)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>logit_model_team_raw <span class="op">=</span> sm.Logit(y_train, sm.add_constant(X_train))</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>result_team_raw <span class="op">=</span> logit_model_team_raw.fit()</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>predictions_team_raw <span class="op">=</span> result_team_raw.predict(sm.add_constant(X_test))</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="classification-report-1" class="level4" data-number="3.2.3">
<h4 data-number="3.2.3" class="anchored" data-anchor-id="classification-report-1"><span class="header-section-number">3.2.3</span> Classification report:</h4>
<div class="cell" data-execution_count="48">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predictions_team_raw.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.59      0.78      0.67      1010
           1       0.55      0.33      0.41       826

    accuracy                           0.58      1836
   macro avg       0.57      0.56      0.54      1836
weighted avg       0.57      0.58      0.56      1836
</code></pre>
</div>
</div>
<section id="test-set-outcome-skew" class="level5">
<h5 class="anchored" data-anchor-id="test-set-outcome-skew">Test set outcome skew:</h5>
<div class="cell" data-execution_count="48">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>y_test.value_counts(normalize<span class="op">=</span><span class="va">True</span>).to_frame(name<span class="op">=</span><span class="st">"Fraction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Fraction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.550109</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.449891</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="84">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_test, predictions_team_raw.<span class="bu">round</span>())</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>auc_score <span class="op">=</span> roc_auc_score(y_test, predictions_team_raw.<span class="bu">round</span>())</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>fig_roc_team_all, ax_roc_team_all <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(base_fig_width, base_fig_height))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>ax_roc_team_all.plot(fpr, tpr, label<span class="op">=</span><span class="st">"ROC curve (AUC = </span><span class="sc">%0.2f</span><span class="st">)"</span> <span class="op">%</span> auc_score)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>ax_roc_team_all.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"k--"</span>)  <span class="co"># Random guessing line</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>ax_roc_team_all.set_xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>ax_roc_team_all.set_ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>ax_roc_team_all.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-roc_team_all" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-roc_team_all-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;11: Receiver operating characteristic curve of the home-win predictions made by a logistic regression model trained on all unmodified team attributes.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-coefficients" class="level5">
<h5 class="anchored" data-anchor-id="model-coefficients">Model coefficients:</h5>
<div class="cell" data-execution_count="63">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>params_team_all <span class="op">=</span> result_team_raw.params[<span class="dv">1</span>:].to_frame(name<span class="op">=</span><span class="st">"Coefficient"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>params_team_all[<span class="st">"p-value"</span>] <span class="op">=</span> result_team_raw.pvalues[<span class="dv">1</span>:].values</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>params_team_all.index <span class="op">=</span> match_win_df_team.drop(columns<span class="op">=</span>cols_to_drop).columns</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>params_team_all.sort_values(<span class="st">"Coefficient"</span>, ascending<span class="op">=</span><span class="va">False</span>).style.applymap(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> value: disf.rb_cell_highlight(value, threshold<span class="op">=</span>significance, higher<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span><span class="st">"p-value"</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="63">
<style type="text/css">
#T_1d29e_row0_col1, #T_1d29e_row1_col1, #T_1d29e_row2_col1, #T_1d29e_row3_col1, #T_1d29e_row14_col1, #T_1d29e_row15_col1, #T_1d29e_row16_col1, #T_1d29e_row17_col1 {
  background-color: rgba(0, 0, 255, 0.25);
}
#T_1d29e_row4_col1, #T_1d29e_row5_col1, #T_1d29e_row6_col1, #T_1d29e_row7_col1, #T_1d29e_row8_col1, #T_1d29e_row9_col1, #T_1d29e_row10_col1, #T_1d29e_row11_col1, #T_1d29e_row12_col1, #T_1d29e_row13_col1 {
  background-color: rgba(255, 0, 0, 0.25);
}
</style>

<div id="tbl-team_all" class="anchored">
<table id="T_1d29e" data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;2: Logistic regression model coefficients obtained by fitting the model using all team attributes without modification.</caption>
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_1d29e_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Coefficient</th>
<th id="T_1d29e_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_1d29e_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">chanceCreationCrossing</td>
<td id="T_1d29e_row0_col0" class="data row0 col0">0.152056</td>
<td id="T_1d29e_row0_col1" class="data row0 col1">0.000039</td>
</tr>
<tr class="even">
<td id="T_1d29e_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">defencePressure</td>
<td id="T_1d29e_row1_col0" class="data row1 col0">0.144163</td>
<td id="T_1d29e_row1_col1" class="data row1 col1">0.000423</td>
</tr>
<tr class="odd">
<td id="T_1d29e_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">defenceAggression</td>
<td id="T_1d29e_row2_col0" class="data row2 col0">0.108681</td>
<td id="T_1d29e_row2_col1" class="data row2 col1">0.005694</td>
</tr>
<tr class="even">
<td id="T_1d29e_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">buildUpPlayPassing_away</td>
<td id="T_1d29e_row3_col0" class="data row3 col0">0.102034</td>
<td id="T_1d29e_row3_col1" class="data row3 col1">0.005645</td>
</tr>
<tr class="odd">
<td id="T_1d29e_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">chanceCreationShooting</td>
<td id="T_1d29e_row4_col0" class="data row4 col0">0.058222</td>
<td id="T_1d29e_row4_col1" class="data row4 col1">0.103961</td>
</tr>
<tr class="even">
<td id="T_1d29e_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">chanceCreationPassing</td>
<td id="T_1d29e_row5_col0" class="data row5 col0">0.054869</td>
<td id="T_1d29e_row5_col1" class="data row5 col1">0.148477</td>
</tr>
<tr class="odd">
<td id="T_1d29e_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">chanceCreationPassing_away</td>
<td id="T_1d29e_row6_col0" class="data row6 col0">0.036955</td>
<td id="T_1d29e_row6_col1" class="data row6 col1">0.326063</td>
</tr>
<tr class="even">
<td id="T_1d29e_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">buildUpPlaySpeed_away</td>
<td id="T_1d29e_row7_col0" class="data row7 col0">0.000000</td>
<td id="T_1d29e_row7_col1" class="data row7 col1">nan</td>
</tr>
<tr class="odd">
<td id="T_1d29e_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">buildUpPlayDribbling</td>
<td id="T_1d29e_row8_col0" class="data row8 col0">-0.009078</td>
<td id="T_1d29e_row8_col1" class="data row8 col1">0.805382</td>
</tr>
<tr class="even">
<td id="T_1d29e_level0_row9" class="row_heading level0 row9" data-quarto-table-cell-role="th">buildUpPlayDribbling_away</td>
<td id="T_1d29e_row9_col0" class="data row9 col0">-0.010104</td>
<td id="T_1d29e_row9_col1" class="data row9 col1">0.781839</td>
</tr>
<tr class="odd">
<td id="T_1d29e_level0_row10" class="row_heading level0 row10" data-quarto-table-cell-role="th">defenceTeamWidth_away</td>
<td id="T_1d29e_row10_col0" class="data row10 col0">-0.032326</td>
<td id="T_1d29e_row10_col1" class="data row10 col1">0.372644</td>
</tr>
<tr class="even">
<td id="T_1d29e_level0_row11" class="row_heading level0 row11" data-quarto-table-cell-role="th">chanceCreationShooting_away</td>
<td id="T_1d29e_row11_col0" class="data row11 col0">-0.044350</td>
<td id="T_1d29e_row11_col1" class="data row11 col1">0.213259</td>
</tr>
<tr class="odd">
<td id="T_1d29e_level0_row12" class="row_heading level0 row12" data-quarto-table-cell-role="th">chanceCreationCrossing_away</td>
<td id="T_1d29e_row12_col0" class="data row12 col0">-0.067888</td>
<td id="T_1d29e_row12_col1" class="data row12 col1">0.064786</td>
</tr>
<tr class="even">
<td id="T_1d29e_level0_row13" class="row_heading level0 row13" data-quarto-table-cell-role="th">defencePressure_away</td>
<td id="T_1d29e_row13_col0" class="data row13 col0">-0.067918</td>
<td id="T_1d29e_row13_col1" class="data row13 col1">0.088940</td>
</tr>
<tr class="odd">
<td id="T_1d29e_level0_row14" class="row_heading level0 row14" data-quarto-table-cell-role="th">defenceTeamWidth</td>
<td id="T_1d29e_row14_col0" class="data row14 col0">-0.073841</td>
<td id="T_1d29e_row14_col1" class="data row14 col1">0.042846</td>
</tr>
<tr class="even">
<td id="T_1d29e_level0_row15" class="row_heading level0 row15" data-quarto-table-cell-role="th">buildUpPlaySpeed</td>
<td id="T_1d29e_row15_col0" class="data row15 col0">-0.075674</td>
<td id="T_1d29e_row15_col1" class="data row15 col1">0.044537</td>
</tr>
<tr class="odd">
<td id="T_1d29e_level0_row16" class="row_heading level0 row16" data-quarto-table-cell-role="th">defenceAggression_away</td>
<td id="T_1d29e_row16_col0" class="data row16 col0">-0.116909</td>
<td id="T_1d29e_row16_col1" class="data row16 col1">0.002445</td>
</tr>
<tr class="even">
<td id="T_1d29e_level0_row17" class="row_heading level0 row17" data-quarto-table-cell-role="th">buildUpPlayPassing</td>
<td id="T_1d29e_row17_col0" class="data row17 col0">-0.119629</td>
<td id="T_1d29e_row17_col1" class="data row17 col1">0.001813</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="team-unmodified-attribute-summary" class="level5">
<h5 class="anchored" data-anchor-id="team-unmodified-attribute-summary">Team unmodified attribute summary</h5>
<p>The logistic regression model, utilizing 18 team attributes, achieved a 58% accuracy in predicting game outcomes, slightly surpassing the dataset’s natural skew. This observation is further supported by the ROC curve, which yielded an area under the curve (AUC) of 0.56. Since we are specifically interested in predicting home winning matches, the model’s precision for home wins was 0.55, while the recall was only 0.33. This outcome is favorable for betting strategies, as we prioritize precise positive predictions and have the option not to place a bet.</p>
<p>The significance analysis of the logistic regression model revealed that the top 4 largest coefficients and the lowest coefficients were deemed statistically significant, while those coefficients falling in between were considered insignificant.</p>
<p>Despite these results, the model’s performance-to-feature ratio is not satisfactory. To address this, we will focus on reducing the number of features by utilizing the differences of these attributes between home and away teams.</p>
</section>
</section>
<section id="logistic-regression-with-home-away-team-attribute-differences" class="level4" data-number="3.2.4">
<h4 data-number="3.2.4" class="anchored" data-anchor-id="logistic-regression-with-home-away-team-attribute-differences"><span class="header-section-number">3.2.4</span> Logistic regression with home-away team attribute differences</h4>
<section id="training-the-model-and-predictions" class="level5">
<h5 class="anchored" data-anchor-id="training-the-model-and-predictions">Training the model and predictions:</h5>
<div class="cell" data-execution_count="68">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>home_win_team_features_dif <span class="op">=</span> match_win_df_team.drop(columns<span class="op">=</span>cols_to_drop)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>home_win_team_features_dif <span class="op">=</span> (</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    home_win_team_features_dif[team_numeric_cols].values</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> home_win_team_features_dif[[col <span class="op">+</span> <span class="st">"_away"</span> <span class="cf">for</span> col <span class="kw">in</span> team_numeric_cols]].values</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>team_feat_names <span class="op">=</span> [i <span class="op">+</span> <span class="st">"_diff"</span> <span class="cf">for</span> i <span class="kw">in</span> team_numeric_cols]</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>home_win_team_features_dif <span class="op">=</span> pd.DataFrame(</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    home_win_team_features_dif,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>team_feat_names,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>home_win_target_team.index,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and test sets</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    home_win_team_features_dif, home_win_target_team, test_size<span class="op">=</span><span class="fl">0.33</span>, random_state<span class="op">=</span><span class="dv">1</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the data</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>team_feat_ratio_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> team_feat_ratio_scaler.fit_transform(X_train)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> team_feat_ratio_scaler.fit_transform(X_test)</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>logit_model_team_dif <span class="op">=</span> sm.Logit(y_train, sm.add_constant(X_train))</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>result_team_dif <span class="op">=</span> logit_model_team_dif.fit()</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>predictions_team_dif <span class="op">=</span> result_team_dif.predict(sm.add_constant(X_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.672126
         Iterations 4</code></pre>
</div>
</div>
</section>
<section id="classification-report-2" class="level5">
<h5 class="anchored" data-anchor-id="classification-report-2">Classification report:</h5>
<div class="cell" data-execution_count="69">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predictions_team_dif.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.59      0.79      0.68      1010
           1       0.56      0.32      0.41       826

    accuracy                           0.58      1836
   macro avg       0.57      0.56      0.54      1836
weighted avg       0.57      0.58      0.55      1836
</code></pre>
</div>
</div>
</section>
<section id="model-coefficients-1" class="level5">
<h5 class="anchored" data-anchor-id="model-coefficients-1">Model coefficients:</h5>
<div class="cell" data-execution_count="71">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>params_team_all <span class="op">=</span> result_team_dif.params[<span class="dv">1</span>:].to_frame(name<span class="op">=</span><span class="st">"Coefficient"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>params_team_all[<span class="st">"p-value"</span>] <span class="op">=</span> result_team_dif.pvalues[<span class="dv">1</span>:].values</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>params_team_all.index <span class="op">=</span> team_feat_names</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>params_team_all.sort_values(<span class="st">"Coefficient"</span>, ascending<span class="op">=</span><span class="va">False</span>).style.applymap(</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> value: disf.rb_cell_highlight(value, threshold<span class="op">=</span>significance, higher<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span><span class="st">"p-value"</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="71">
<style type="text/css">
#T_d0c5b_row0_col1, #T_d0c5b_row1_col1, #T_d0c5b_row2_col1, #T_d0c5b_row8_col1 {
  background-color: rgba(0, 0, 255, 0.25);
}
#T_d0c5b_row3_col1, #T_d0c5b_row4_col1, #T_d0c5b_row5_col1, #T_d0c5b_row6_col1, #T_d0c5b_row7_col1 {
  background-color: rgba(255, 0, 0, 0.25);
}
</style>

<div id="tbl-team_dif" class="anchored">
<table id="T_d0c5b" data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;3: Logistic regression model coefficients obtained by fitting the model using the differences of team attributes.</caption>
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_d0c5b_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Coefficient</th>
<th id="T_d0c5b_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_d0c5b_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">chanceCreationCrossing_diff</td>
<td id="T_d0c5b_row0_col0" class="data row0 col0">0.153614</td>
<td id="T_d0c5b_row0_col1" class="data row0 col1">0.000030</td>
</tr>
<tr class="even">
<td id="T_d0c5b_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">defenceAggression_diff</td>
<td id="T_d0c5b_row1_col0" class="data row1 col0">0.152408</td>
<td id="T_d0c5b_row1_col1" class="data row1 col1">0.000104</td>
</tr>
<tr class="odd">
<td id="T_d0c5b_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">defencePressure_diff</td>
<td id="T_d0c5b_row2_col0" class="data row2 col0">0.149047</td>
<td id="T_d0c5b_row2_col1" class="data row2 col1">0.000379</td>
</tr>
<tr class="even">
<td id="T_d0c5b_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">chanceCreationShooting_diff</td>
<td id="T_d0c5b_row3_col0" class="data row3 col0">0.068049</td>
<td id="T_d0c5b_row3_col1" class="data row3 col1">0.052230</td>
</tr>
<tr class="odd">
<td id="T_d0c5b_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">chanceCreationPassing_diff</td>
<td id="T_d0c5b_row4_col0" class="data row4 col0">0.011143</td>
<td id="T_d0c5b_row4_col1" class="data row4 col1">0.766147</td>
</tr>
<tr class="even">
<td id="T_d0c5b_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">buildUpPlayDribbling_diff</td>
<td id="T_d0c5b_row5_col0" class="data row5 col0">0.003255</td>
<td id="T_d0c5b_row5_col1" class="data row5 col1">0.925469</td>
</tr>
<tr class="odd">
<td id="T_d0c5b_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">defenceTeamWidth_diff</td>
<td id="T_d0c5b_row6_col0" class="data row6 col0">-0.027599</td>
<td id="T_d0c5b_row6_col1" class="data row6 col1">0.448482</td>
</tr>
<tr class="even">
<td id="T_d0c5b_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">buildUpPlaySpeed_diff</td>
<td id="T_d0c5b_row7_col0" class="data row7 col0">-0.052334</td>
<td id="T_d0c5b_row7_col1" class="data row7 col1">0.159906</td>
</tr>
<tr class="odd">
<td id="T_d0c5b_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">buildUpPlayPassing_diff</td>
<td id="T_d0c5b_row8_col0" class="data row8 col0">-0.155055</td>
<td id="T_d0c5b_row8_col1" class="data row8 col1">0.000062</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Reducing the number of features in half by calculating the difference between home and away teams did not compromise the predictive power of the model. Furthermore only four features were determined to be significant, as expected most of these were positive (diiferences in chance creation crossing, defence aggression, and defence pressiure), yet one negative feature “build up play passing” was also significant.</p>
</section>
<section id="building-a-model-with-only-significant-features" class="level5">
<h5 class="anchored" data-anchor-id="building-a-model-with-only-significant-features">Building a model with only significant features:</h5>
<div class="cell" data-execution_count="82">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting significant features based on previous model</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>significant_team_features <span class="op">=</span> params_team_all.loc[</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    params_team_all[<span class="st">"p-value"</span>] <span class="op">&lt;</span> significance</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>].index.to_list()</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and test sets</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    home_win_team_features_dif[significant_team_features],</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    home_win_target_team,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.33</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the data</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>team_feat_ratio_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> team_feat_ratio_scaler.fit_transform(X_train)</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> team_feat_ratio_scaler.fit_transform(X_test)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>logit_model_team_dif <span class="op">=</span> sm.Logit(y_train, sm.add_constant(X_train))</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>result_team_dif <span class="op">=</span> logit_model_team_dif.fit()</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>predictions_team_dif <span class="op">=</span> result_team_dif.predict(sm.add_constant(X_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.672929
         Iterations 4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="80">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predictions_team_dif.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.59      0.81      0.68      1010
           1       0.58      0.32      0.41       826

    accuracy                           0.59      1836
   macro avg       0.58      0.56      0.55      1836
weighted avg       0.58      0.59      0.56      1836
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="85">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_test, predictions_team_dif.<span class="bu">round</span>())</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>auc_score <span class="op">=</span> roc_auc_score(y_test, predictions_team_dif.<span class="bu">round</span>())</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>fig_roc_team_dif, ax_roc_team_dif <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(base_fig_width, base_fig_height))</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>ax_roc_team_dif.plot(fpr, tpr, label<span class="op">=</span><span class="st">"ROC curve (AUC = </span><span class="sc">%0.2f</span><span class="st">)"</span> <span class="op">%</span> auc_score)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>ax_roc_team_dif.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"k--"</span>)  <span class="co"># Random guessing line</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>ax_roc_team_dif.set_xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>ax_roc_team_dif.set_ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>ax_roc_team_dif.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-roc_team_dif" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="analysis_files/figure-html/fig-roc_team_dif-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;12: Receiver operating characteristic curve of the home-win predictions made by a logistic regression model trained on significant team attribute differences.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="team-attribute-summary" class="level4" data-number="3.2.5">
<h4 data-number="3.2.5" class="anchored" data-anchor-id="team-attribute-summary"><span class="header-section-number">3.2.5</span> Team attribute summary</h4>
<p>By calculating the differences in team attributes and subsequently selecting only the significant differences, the model’s performance was not compromised. On the contrary, it even exhibited an increase of one percentage point in accuracy and precision when predicting home team winning matches. As a result, these four significant team attribute differences will be retained and utilized in the final model.</p>
</section>
</section>
<section id="player-attributes-1" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="player-attributes-1"><span class="header-section-number">3.3</span> Player Attributes</h3>
<p>To avoid outcome data leakage and address the dynamic nature of player attributes and team composition, a custom class called “MatchPlayers” was implemented. This class includes a subclass named “Player” and incorporates several methods to handle the data preparation challenges effectively.</p>
<p>Since player attributes may undergo updates over time, it is essential to ensure that the model does not have access to future information when making predictions. To achieve this, the “MatchPlayers” class ensures that player attribute data is appropriately partitioned and processed, preventing any leakage of information from future matches.</p>
<p>Additionally, teams consist of 11 different players, and their compositions can change over time. Managing these variations is vital for accurate predictions. The class efficiently handles team composition changes, allowing for proper data alignment and processing during model training and evaluation.</p>
<p>Furthermore, the inclusion of goalkeepers presents an additional complexity, as they possess a distinct set of attributes compared to other players as was shown in <a href="#tbl-rating_att_corr">Table&nbsp;1</a>. The “MatchPlayers” class addresses this issue by appropriately differentiating and handling goalkeeper attributes to ensure their relevance in the model without compromising overall data integrity.</p>
<p>Moreover, the “MatchPlayers” class also includes functions to export different sets of features, as well as their transformed variants, allowing for flexible feature selection and manipulation during the model building process. This feature further enhances the adaptability and utility of the custom class in preparing the data for predictive modeling.</p>
<section id="getting-the-date-relevant-attributes-of-each-match-player-using-the-matchplayers-class-player-subclass-and-their-functions" class="level5">
<h5 class="anchored" data-anchor-id="getting-the-date-relevant-attributes-of-each-match-player-using-the-matchplayers-class-player-subclass-and-their-functions">Getting the date relevant attributes of each match player using the MatchPlayers class Player subclass and their functions:</h5>
<p>10+ min processing time warning!</p>
<div class="cell" data-execution_count="54">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # only using rows with team attributes</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># match_win_df_player = match_win_df.copy()[</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     match_win_df.index.isin(match_win_df_team.index)</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ]</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # Creating MatchPlayers objects for each match</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># match_players_series = {}</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in match_win_df_player.index:</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     match_players_series[i] = MatchPlayers()</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># match_players_series = pd.Series(match_players_series, name="match_players")</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="co"># match_win_df_player = match_win_df_player.join(match_players_series)</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # Using the MatchPlayers methods and the player subclass and it's methods to store date</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="co"># # player attribute data for each match</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="co"># for index, row in match_raw[match_raw.index.isin(match_win_df_player.index)].iterrows():</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     match_win_df_player.at[index, "match_players"].get_data(row)</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     match_win_df_player.at[index, "match_players"].get_player_positions()</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     match_win_df_player.at[index, "match_players"].get_player_ids()</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     match_win_df_player.at[index, "match_players"].home_players[</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="co">#         "goaly"</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     ].get_player_attributes(player_attr_raw, row["date"])</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     match_win_df_player.at[index, "match_players"].away_players[</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a><span class="co">#         "goaly"</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     ].get_player_attributes(player_attr_raw, row["date"])</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     for player in match_win_df_player.at[index, "match_players"].home_players[</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="co">#         "players"</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     ]:</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a><span class="co">#         player.get_player_attributes(player_attr_raw, row["date"])</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     for player in match_win_df_player.at[index, "match_players"].away_players[</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a><span class="co">#         "players"</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     ]:</span></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a><span class="co">#         player.get_player_attributes(player_attr_raw, row["date"])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="optional-code-for-saving-and-loading-sorted-match-data-for-further-use" class="level5">
<h5 class="anchored" data-anchor-id="optional-code-for-saving-and-loading-sorted-match-data-for-further-use">Optional code for saving and loading sorted match data for further use:</h5>
<div class="cell" data-execution_count="87">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># with open('match_win_df_player.pkl', 'wb') as file:</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     pickle.dump(match_win_df_player, file)</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"match_win_df_player.pkl"</span>, <span class="st">"rb"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    match_win_df_player <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>By employing the custom class “MatchPlayers” with its “Player” subclass and various methods, the data preparation challenges related to player attributes, team compositions, and goalkeeper attributes were effectively overcome, providing a robust foundation for building an accurate predictive model.</p>
</section>
<section id="logistic-regression-using-all-attributes" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="logistic-regression-using-all-attributes"><span class="header-section-number">3.3.1</span> Logistic regression using all attributes</h4>
<p>Due to the large number of different players and their attributes in a single match, the resulting feature set from the “MatchPlayers” class can consist of up to 770 different features. However, with only around five thousand samples available, this leads to an unbalanced feature-to-sample ratio in our training set, necessitating feature reduction.</p>
<p>In the first iteration of the model, all possible player attributes without any modifications were utilized. These attributes were then used to train a logistic regression model to predict whether the home team wins the match. To mitigate potential overfitting and reduce the inclusion of less important features, the fitting function employed regularization with an alpha value of 0.1.</p>
<section id="exporting-all-player-attributes" class="level5">
<h5 class="anchored" data-anchor-id="exporting-all-player-attributes">Exporting all player attributes:</h5>
<div class="cell" data-execution_count="96">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export all player attributes for each mach in to a dictionary</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>player_att_dict <span class="op">=</span> {}</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> match_win_df_player.index:</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    player_att_dict[i] <span class="op">=</span> match_win_df_player.at[</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>        i, <span class="st">"match_players"</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    ].export_player_attributes(player_attr_numeric, how<span class="op">=</span><span class="st">"all"</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging with the match dataframe</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>match_win_players <span class="op">=</span> pd.DataFrame.from_dict(player_att_dict, orient<span class="op">=</span><span class="st">"index"</span>).join(</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    match_win_df[<span class="st">"home_team_win"</span>]</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropping rows with missing values</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>match_win_players.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="co"># In some cases missing attributes were returned as empty dictionaries, dropping these rows</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>match_win_players <span class="op">=</span> match_win_players[</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    match_win_players.<span class="bu">apply</span>(</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: <span class="va">False</span> <span class="cf">if</span> <span class="bu">dict</span> <span class="kw">in</span> [<span class="bu">type</span>(i) <span class="cf">for</span> i <span class="kw">in</span> x.values] <span class="cf">else</span> <span class="va">True</span>, axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="logistic-regression-with-all-player-attributes" class="level5">
<h5 class="anchored" data-anchor-id="logistic-regression-with-all-player-attributes">Logistic Regression with all player attributes:</h5>
<div class="cell" data-execution_count="97">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>home_win_target_player <span class="op">=</span> match_win_players[<span class="st">"home_team_win"</span>]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>home_win_features_player <span class="op">=</span> match_win_players.drop(columns<span class="op">=</span><span class="st">"home_team_win"</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    home_win_features_player, home_win_target_player, test_size<span class="op">=</span><span class="fl">0.33</span>, random_state<span class="op">=</span><span class="dv">1</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling the data</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>player_feat_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> player_feat_scaler.fit_transform(X_train)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> player_feat_scaler.fit_transform(X_test)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>logit_model_player_all <span class="op">=</span> sm.Logit(y_train, sm.add_constant(X_train))</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>result_player_all <span class="op">=</span> logit_model_player_all.fit_regularized(</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">"l1_cvxopt_cp"</span>, alpha<span class="op">=</span><span class="fl">0.1</span>, disp<span class="op">=</span><span class="dv">0</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>predictions_player_all <span class="op">=</span> result_player_all.predict(sm.add_constant(X_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="classification-report-3" class="level5">
<h5 class="anchored" data-anchor-id="classification-report-3">Classification report:</h5>
<div class="cell" data-execution_count="98">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predictions_player_all.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.62      0.62      0.62       933
           1       0.52      0.52      0.52       736

    accuracy                           0.58      1669
   macro avg       0.57      0.57      0.57      1669
weighted avg       0.58      0.58      0.58      1669
</code></pre>
</div>
</div>
</section>
<section id="area-under-the-receiver-operating-characteristic-curve" class="level5">
<h5 class="anchored" data-anchor-id="area-under-the-receiver-operating-characteristic-curve">Area under the receiver operating characteristic curve:</h5>
<div class="cell" data-execution_count="107">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_test, predictions_player_all.<span class="bu">round</span>()).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>0.57</code></pre>
</div>
</div>
</section>
<section id="what-is-the-test-data-set-skew" class="level5">
<h5 class="anchored" data-anchor-id="what-is-the-test-data-set-skew">What is the test data set skew?</h5>
<div class="cell" data-execution_count="99">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>y_test.value_counts(normalize<span class="op">=</span><span class="va">True</span>).to_frame(<span class="st">"Fraction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="99">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Fraction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.559017</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.440983</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="coefficients-and-their-p-values" class="level5">
<h5 class="anchored" data-anchor-id="coefficients-and-their-p-values">Coefficients and their p-values:</h5>
<div class="cell" data-execution_count="112">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying the coefficients and their p-values</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>params_player_all <span class="op">=</span> result_player_all.params[<span class="dv">1</span>:].to_frame(name<span class="op">=</span><span class="st">"Coefficient"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>params_player_all[<span class="st">"p-value"</span>] <span class="op">=</span> result_player_all.pvalues[<span class="dv">1</span>:].values</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>params_player_all.index <span class="op">=</span> home_win_features_player.columns</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"Largest positive coefficients:"</span>))</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>display(</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    params_player_all.sort_values(<span class="st">"Coefficient"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    .head()</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    .style.applymap(</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> value: disf.rb_cell_highlight(</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>            value, threshold<span class="op">=</span>significance, higher<span class="op">=</span><span class="va">False</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>        subset<span class="op">=</span><span class="st">"p-value"</span>,</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:.3f}</span><span class="st">"</span>)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"Largest negative coefficients:"</span>))</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>display(</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    params_player_all.sort_values(<span class="st">"Coefficient"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    .tail()</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    .style.applymap(</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> value: disf.rb_cell_highlight(</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>            value, threshold<span class="op">=</span>significance, higher<span class="op">=</span><span class="va">False</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>        subset<span class="op">=</span><span class="st">"p-value"</span>,</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:.3f}</span><span class="st">"</span>)</span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p>Largest positive coefficients:</p>
</div>
<div class="cell-output cell-output-display">
<style type="text/css">
#T_4f8c9_row0_col1, #T_4f8c9_row1_col1, #T_4f8c9_row3_col1 {
  background-color: rgba(0, 0, 255, 0.25);
}
#T_4f8c9_row2_col1, #T_4f8c9_row4_col1 {
  background-color: rgba(255, 0, 0, 0.25);
}
</style>

<table id="T_4f8c9" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_4f8c9_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Coefficient</th>
<th id="T_4f8c9_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_4f8c9_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">overall_rating_A_6</td>
<td id="T_4f8c9_row0_col0" class="data row0 col0">0.503</td>
<td id="T_4f8c9_row0_col1" class="data row0 col1">0.007</td>
</tr>
<tr class="even">
<td id="T_4f8c9_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">marking_A_2</td>
<td id="T_4f8c9_row1_col0" class="data row1 col0">0.458</td>
<td id="T_4f8c9_row1_col1" class="data row1 col1">0.004</td>
</tr>
<tr class="odd">
<td id="T_4f8c9_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">overall_rating_H_2</td>
<td id="T_4f8c9_row2_col0" class="data row2 col0">0.425</td>
<td id="T_4f8c9_row2_col1" class="data row2 col1">0.172</td>
</tr>
<tr class="even">
<td id="T_4f8c9_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">ball_control_A_10</td>
<td id="T_4f8c9_row3_col0" class="data row3 col0">0.388</td>
<td id="T_4f8c9_row3_col1" class="data row3 col1">0.010</td>
</tr>
<tr class="odd">
<td id="T_4f8c9_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">sliding_tackle_H_gk</td>
<td id="T_4f8c9_row4_col0" class="data row4 col0">0.324</td>
<td id="T_4f8c9_row4_col1" class="data row4 col1">0.063</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">
<p>Largest negative coefficients:</p>
</div>
<div class="cell-output cell-output-display">
<style type="text/css">
#T_cce0b_row0_col1, #T_cce0b_row3_col1, #T_cce0b_row4_col1 {
  background-color: rgba(255, 0, 0, 0.25);
}
#T_cce0b_row1_col1, #T_cce0b_row2_col1 {
  background-color: rgba(0, 0, 255, 0.25);
}
</style>

<table id="T_cce0b" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_cce0b_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Coefficient</th>
<th id="T_cce0b_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_cce0b_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">overall_rating_H_gk</td>
<td id="T_cce0b_row0_col0" class="data row0 col0">-0.500</td>
<td id="T_cce0b_row0_col1" class="data row0 col1">0.562</td>
</tr>
<tr class="even">
<td id="T_cce0b_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">sliding_tackle_H_5</td>
<td id="T_cce0b_row1_col0" class="data row1 col0">-0.507</td>
<td id="T_cce0b_row1_col1" class="data row1 col1">0.006</td>
</tr>
<tr class="odd">
<td id="T_cce0b_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">overall_rating_H_10</td>
<td id="T_cce0b_row2_col0" class="data row2 col0">-0.523</td>
<td id="T_cce0b_row2_col1" class="data row2 col1">0.047</td>
</tr>
<tr class="even">
<td id="T_cce0b_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">overall_rating_A_2</td>
<td id="T_cce0b_row3_col0" class="data row3 col0">-0.606</td>
<td id="T_cce0b_row3_col1" class="data row3 col1">0.211</td>
</tr>
<tr class="odd">
<td id="T_cce0b_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">overall_rating_A_gk</td>
<td id="T_cce0b_row4_col0" class="data row4 col0">-1.033</td>
<td id="T_cce0b_row4_col1" class="data row4 col1">0.236</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The model utilizing all player attributes achieved a similar accuracy of 58% compared to the one trained on team attributes, but it involved the use of a substantially higher number of features (770 attributes). Furthermore, this model exhibited a higher recall, which compromises potential profits from betting due to increased false positives.</p>
<p>Given the large number of features relative to the limited number of samples, even when employing lasso regression to penalize large coefficients, some coefficients with significant magnitudes had p-values above the significance level. As a result, it becomes evident that to enhance the model’s predictive power and simplicity, it is necessary to reduce the number of features.</p>
</section>
</section>
<section id="logistic-regression-using-the-differences-of-player-attributes" class="level4" data-number="3.3.2">
<h4 data-number="3.3.2" class="anchored" data-anchor-id="logistic-regression-using-the-differences-of-player-attributes"><span class="header-section-number">3.3.2</span> Logistic regression using the differences of player attributes:</h4>
<p>The most straightforward approach to feature reduction is employed here by utilizing the differences in attributes between home and away players instead of considering attributes from all players individually. By adopting this method, the number of features is effectively reduced by half.</p>
<p>To address the challenge of distinguishing the importance of players in specific positions, a more generalized approach is implemented. Instead of using separate attribute differences for each player, the average of all non-goalkeeper players’ attributes is utilized. This further reduces the number of features significantly, resulting in a final set of 70 features from the initial 770.</p>
<p>This reduction in the number of features streamlines the model, making it more interpretable and computationally efficient while retaining relevant information for predicting home team wins in football matches.</p>
<section id="fetching-relevant-differences-of-player-attributes" class="level5">
<h5 class="anchored" data-anchor-id="fetching-relevant-differences-of-player-attributes">Fetching relevant differences of player attributes:</h5>
<div class="cell" data-execution_count="101">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>player_att_dict <span class="op">=</span> {}</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> match_win_df_player.index:</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    player_att_dict[i] <span class="op">=</span> match_win_df_player.at[</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>        i, <span class="st">"match_players"</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    ].export_player_attributes(player_attr_numeric, how<span class="op">=</span><span class="st">"avg_diff"</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>match_win_players <span class="op">=</span> pd.DataFrame.from_dict(player_att_dict, orient<span class="op">=</span><span class="st">"index"</span>).join(</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    match_win_df[<span class="st">"home_team_win"</span>]</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropping rows with missing values</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>match_win_players.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co"># In some cases missing attributes were returned as empty dictionaries, dropping these rows</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>match_win_players <span class="op">=</span> match_win_players[</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    match_win_players.<span class="bu">apply</span>(</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: <span class="va">False</span> <span class="cf">if</span> <span class="bu">dict</span> <span class="kw">in</span> [<span class="bu">type</span>(i) <span class="cf">for</span> i <span class="kw">in</span> x.values] <span class="cf">else</span> <span class="va">True</span>, axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="logistic-regression-model-training-and-predictions" class="level5">
<h5 class="anchored" data-anchor-id="logistic-regression-model-training-and-predictions">Logistic regression model training and predictions:</h5>
<div class="cell" data-execution_count="102">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>home_win_target_playerdif <span class="op">=</span> match_win_players[<span class="st">"home_team_win"</span>]</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>home_win_features_playerdif <span class="op">=</span> match_win_players.drop(columns<span class="op">=</span><span class="st">"home_team_win"</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    home_win_features_playerdif,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    home_win_target_playerdif,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.33</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling the data</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>player_feat_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> player_feat_scaler.fit_transform(X_train)</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> player_feat_scaler.fit_transform(X_test)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>logit_model_player_dif <span class="op">=</span> sm.Logit(y_train, sm.add_constant(X_train))</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>result_player_dif <span class="op">=</span> logit_model_player_dif.fit_regularized(</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">"l1_cvxopt_cp"</span>, alpha<span class="op">=</span><span class="fl">0.1</span>, disp<span class="op">=</span><span class="dv">0</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>predictions_player_dif <span class="op">=</span> result_player_dif.predict(sm.add_constant(X_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="classification-report-4" class="level5">
<h5 class="anchored" data-anchor-id="classification-report-4">Classification report:</h5>
<div class="cell" data-execution_count="103">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predictions_player_dif.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.67      0.75      0.71       933
           1       0.62      0.53      0.58       736

    accuracy                           0.65      1669
   macro avg       0.65      0.64      0.64      1669
weighted avg       0.65      0.65      0.65      1669
</code></pre>
</div>
</div>
</section>
<section id="area-under-the-receiver-operating-characteristic-curve-1" class="level5">
<h5 class="anchored" data-anchor-id="area-under-the-receiver-operating-characteristic-curve-1">Area under the receiver operating characteristic curve:</h5>
<div class="cell" data-execution_count="109">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_test, predictions_player_dif.<span class="bu">round</span>()).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>0.64</code></pre>
</div>
</div>
</section>
<section id="the-most-important-coefficients-and-their-p-values" class="level5">
<h5 class="anchored" data-anchor-id="the-most-important-coefficients-and-their-p-values">The most important coefficients and their p-values</h5>
<div class="cell" data-execution_count="113">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>params_player_dif <span class="op">=</span> result_player_dif.params[<span class="dv">1</span>:].to_frame(name<span class="op">=</span><span class="st">"Coefficient"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>params_player_dif[<span class="st">"p-value"</span>] <span class="op">=</span> result_player_dif.pvalues[<span class="dv">1</span>:].values</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>params_player_dif.index <span class="op">=</span> home_win_features_playerdif.columns</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"Largest positive coefficients:"</span>))</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>display(params_player_dif.sort_values(<span class="st">"Coefficient"</span>, ascending<span class="op">=</span><span class="va">False</span>).head().style.applymap(</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> value: disf.rb_cell_highlight(value, threshold<span class="op">=</span>significance, higher<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span><span class="st">"p-value"</span>,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>).<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:.3f}</span><span class="st">"</span>))</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"Largest negative coefficients:"</span>))</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>display(params_player_dif.sort_values(<span class="st">"Coefficient"</span>, ascending<span class="op">=</span><span class="va">False</span>).tail().style.applymap(</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> value: disf.rb_cell_highlight(value, threshold<span class="op">=</span>significance, higher<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span><span class="st">"p-value"</span>,</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>).<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:.3f}</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p>Largest positive coefficients:</p>
</div>
<div class="cell-output cell-output-display">
<style type="text/css">
#T_4b72a_row0_col1, #T_4b72a_row4_col1 {
  background-color: rgba(255, 0, 0, 0.25);
}
#T_4b72a_row1_col1, #T_4b72a_row2_col1, #T_4b72a_row3_col1 {
  background-color: rgba(0, 0, 255, 0.25);
}
</style>

<table id="T_4b72a" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_4b72a_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Coefficient</th>
<th id="T_4b72a_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_4b72a_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">overall_rating_avg_diff_gk</td>
<td id="T_4b72a_row0_col0" class="data row0 col0">0.656</td>
<td id="T_4b72a_row0_col1" class="data row0 col1">0.151</td>
</tr>
<tr class="even">
<td id="T_4b72a_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">overall_rating_avg_diff</td>
<td id="T_4b72a_row1_col0" class="data row1 col0">0.350</td>
<td id="T_4b72a_row1_col1" class="data row1 col1">0.046</td>
</tr>
<tr class="odd">
<td id="T_4b72a_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">vision_avg_diff</td>
<td id="T_4b72a_row2_col0" class="data row2 col0">0.240</td>
<td id="T_4b72a_row2_col1" class="data row2 col1">0.015</td>
</tr>
<tr class="even">
<td id="T_4b72a_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">acceleration_avg_diff</td>
<td id="T_4b72a_row3_col0" class="data row3 col0">0.205</td>
<td id="T_4b72a_row3_col1" class="data row3 col1">0.050</td>
</tr>
<tr class="odd">
<td id="T_4b72a_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">standing_tackle_avg_diff</td>
<td id="T_4b72a_row4_col0" class="data row4 col0">0.185</td>
<td id="T_4b72a_row4_col1" class="data row4 col1">0.083</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">
<p>Largest negative coefficients:</p>
</div>
<div class="cell-output cell-output-display">
<style type="text/css">
#T_7938d_row0_col1, #T_7938d_row2_col1, #T_7938d_row3_col1, #T_7938d_row4_col1 {
  background-color: rgba(255, 0, 0, 0.25);
}
#T_7938d_row1_col1 {
  background-color: rgba(0, 0, 255, 0.25);
}
</style>

<table id="T_7938d" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_7938d_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Coefficient</th>
<th id="T_7938d_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_7938d_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">gk_handling_avg_diff_gk</td>
<td id="T_7938d_row0_col0" class="data row0 col0">-0.169</td>
<td id="T_7938d_row0_col1" class="data row0 col1">0.190</td>
</tr>
<tr class="even">
<td id="T_7938d_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">reactions_avg_diff_gk</td>
<td id="T_7938d_row1_col0" class="data row1 col0">-0.170</td>
<td id="T_7938d_row1_col1" class="data row1 col1">0.042</td>
</tr>
<tr class="odd">
<td id="T_7938d_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">sliding_tackle_avg_diff</td>
<td id="T_7938d_row2_col0" class="data row2 col0">-0.175</td>
<td id="T_7938d_row2_col1" class="data row2 col1">0.077</td>
</tr>
<tr class="even">
<td id="T_7938d_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">gk_diving_avg_diff_gk</td>
<td id="T_7938d_row3_col0" class="data row3 col0">-0.177</td>
<td id="T_7938d_row3_col1" class="data row3 col1">0.198</td>
</tr>
<tr class="odd">
<td id="T_7938d_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">dribbling_avg_diff</td>
<td id="T_7938d_row4_col0" class="data row4 col0">-0.206</td>
<td id="T_7938d_row4_col1" class="data row4 col1">0.068</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The reduction in the number of features, achieved by calculating the average differences of player attributes, has significantly improved the predictive power of the model. The model now exhibits an overall accuracy of 65%, an area under the receiver operating characteristic curve (AUC-ROC) of 0.64, and precision and recall values of 0.62 and 0.53, respectively, when predicting home team wins.</p>
<p>Despite this success, it is important to note that not all of the largest coefficients in the model are statistically significant. This indicates a level of uncertainty in their determination and suggests that there is room for further improvement in the model.</p>
</section>
</section>
<section id="recursive-feature-elimination" class="level4" data-number="3.3.3">
<h4 data-number="3.3.3" class="anchored" data-anchor-id="recursive-feature-elimination"><span class="header-section-number">3.3.3</span> Recursive feature elimination</h4>
<p>To further improve the model and address the challenge of reducing the number of features, we will employ Recursive Feature Elimination (RFE) with cross-validation.</p>
<p>RFE with cross-validation allows us to identify the most relevant features that contribute significantly to the model’s predictive performance. By iteratively removing less informative features, we can achieve a more efficient and interpretable model without sacrificing accuracy or precision.</p>
<div class="cell" data-execution_count="63">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    home_win_features_playerdif,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    home_win_target_playerdif,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.33</span>,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling the data</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>player_feat_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> player_feat_scaler.fit_transform(X_train)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> player_feat_scaler.fit_transform(X_test)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create RFE object and perform feature selection</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>logreg_model_player_pre_rfe <span class="op">=</span> LogisticRegression()</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>rfe_player <span class="op">=</span> RFECV(estimator<span class="op">=</span>logreg_model_player_pre_rfe)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>rfe_player.fit(X_train, y_train)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>rfe_selected_columns <span class="op">=</span> home_win_features_playerdif.columns[rfe_player.support_]</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the top features based on RFE</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>X_train_rfe <span class="op">=</span> rfe_player.transform(X_train)</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>X_test_rfe <span class="op">=</span> rfe_player.transform(X_test)</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Refit the logistic regression model with selected features</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>logreg_model_rfe <span class="op">=</span> sm.Logit(y_train, sm.add_constant(X_train_rfe))</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>result_player_rfe <span class="op">=</span> logreg_model_rfe.fit(disp<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model with selected features</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>predictions_rfe <span class="op">=</span> result_player_rfe.predict(sm.add_constant(X_test_rfe))</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the predicted probabilities</span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predictions_rfe.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.67      0.77      0.71       933
           1       0.64      0.52      0.57       736

    accuracy                           0.66      1669
   macro avg       0.65      0.64      0.64      1669
weighted avg       0.66      0.66      0.65      1669
</code></pre>
</div>
</div>
<section id="features-selected-by-rfe-and-their-coefficients" class="level5">
<h5 class="anchored" data-anchor-id="features-selected-by-rfe-and-their-coefficients">Features selected by RFE and their coefficients:</h5>
<div class="cell" data-execution_count="64">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>player_rfe_params <span class="op">=</span> result_player_rfe.params[<span class="dv">1</span>:].to_frame(name<span class="op">=</span><span class="st">"Coefficient"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>player_rfe_params[<span class="st">"p-value"</span>] <span class="op">=</span> result_player_rfe.pvalues[<span class="dv">1</span>:].values</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>player_rfe_params.index <span class="op">=</span> rfe_selected_columns</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"Largest positive coefficients:"</span>))</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>display(player_rfe_params.sort_values(<span class="st">"Coefficient"</span>, ascending<span class="op">=</span><span class="va">False</span>).head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p>Largest positive coefficients:</p>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Coefficient</th>
<th data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">overall_rating_avg_diff</td>
<td>0.620137</td>
<td>8.780594e-16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">vision_avg_diff</td>
<td>0.193314</td>
<td>6.013069e-03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">standing_tackle_avg_diff</td>
<td>0.152692</td>
<td>7.746064e-02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sliding_tackle_avg_diff</td>
<td>-0.198702</td>
<td>2.004563e-02</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="single-feature" class="level4" data-number="3.3.4">
<h4 data-number="3.3.4" class="anchored" data-anchor-id="single-feature"><span class="header-section-number">3.3.4</span> Single Feature</h4>
<div class="cell" data-execution_count="65">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    home_win_features_playerdif[<span class="st">"overall_rating_avg_diff"</span>],</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    home_win_target_playerdif,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.33</span>,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling the data</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>player_feat_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> player_feat_scaler.fit_transform(X_train.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> player_feat_scaler.fit_transform(X_test.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>logreg_model_overall_rat <span class="op">=</span> sm.Logit(y_train, sm.add_constant(X_train))</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>result_player_overall_rat <span class="op">=</span> logreg_model_overall_rat.fit(disp<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model with selected features</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>predictions_overall_rat <span class="op">=</span> result_player_overall_rat.predict(sm.add_constant(X_test))</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the predicted probabilities</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predictions_overall_rat.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.66      0.76      0.71       933
           1       0.63      0.51      0.56       736

    accuracy                           0.65      1669
   macro avg       0.65      0.64      0.64      1669
weighted avg       0.65      0.65      0.65      1669
</code></pre>
</div>
</div>
<section id="model-plot" class="level5">
<h5 class="anchored" data-anchor-id="model-plot">Model plot:</h5>
<div class="cell" data-execution_count="66">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>fig_player_log, ax_player_log <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(base_fig_width, base_fig_height))</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>x_values <span class="op">=</span> np.linspace(<span class="bu">min</span>(X_test), <span class="bu">max</span>(X_test), <span class="dv">100</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate corresponding y-values using logistic function</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>y_values <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> np.exp(</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span>(</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>            result_player_overall_rat.params[<span class="dv">1</span>] <span class="op">*</span> x_values</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> result_player_overall_rat.params[<span class="dv">0</span>]</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>ax_player_log.scatter(X_test, y_test)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>ax_player_log.plot(x_values, y_values)</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>disf.axis_titles(ax_player_log, <span class="st">"Difference in average player overall rating"</span>)</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>ax_player_log.set_yticks((<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>ax_player_log.set_yticklabels((<span class="st">"Home loss/tie"</span>, <span class="st">"Home win"</span>))</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="analysis_files/figure-html/cell-75-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="game-outcome-prediction-models" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="game-outcome-prediction-models"><span class="header-section-number">4</span> Game outcome prediction models</h2>
<section id="home-win" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="home-win"><span class="header-section-number">4.1</span> Home win</h3>
<section id="model-training-and-predictions" class="level4" data-number="4.1.1">
<h4 data-number="4.1.1" class="anchored" data-anchor-id="model-training-and-predictions"><span class="header-section-number">4.1.1</span> Model Training and predictions</h4>
<section id="creating-a-dataframe-with-all-features-to-be-used" class="level5">
<h5 class="anchored" data-anchor-id="creating-a-dataframe-with-all-features-to-be-used">Creating a dataframe with all features to be used:</h5>
<div class="cell" data-execution_count="67">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>match_win_final_df <span class="op">=</span> match_win_df.merge(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    home_win_features_playerdif[rfe_selected_columns], left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>match_win_final_df <span class="op">=</span> match_win_final_df.merge(</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    home_win_team_features_dif, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fitting-the-model-and-making-predictions" class="level5">
<h5 class="anchored" data-anchor-id="fitting-the-model-and-making-predictions">Fitting the model and making predictions:</h5>
<div class="cell" data-execution_count="68">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>home_win_final_target <span class="op">=</span> match_win_final_df[<span class="st">"home_team_win"</span>]</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>home_win_final_features <span class="op">=</span> match_win_final_df[</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    team_feat_names <span class="op">+</span> rfe_selected_columns.to_list()</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>X_train_win, X_test_win, y_train_win, y_test_win <span class="op">=</span> train_test_split(</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    home_win_final_features,</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    home_win_final_target,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.33</span>,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling the data</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>final_feat_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>X_train_win <span class="op">=</span> player_feat_scaler.fit_transform(X_train_win)</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>X_test_win <span class="op">=</span> player_feat_scaler.fit_transform(X_test_win)</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>logit_model_win <span class="op">=</span> sm.Logit(y_train_win, sm.add_constant(X_train_win))</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>result_win_final <span class="op">=</span> logit_model_win.fit_regularized(</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">"l1_cvxopt_cp"</span>, alpha<span class="op">=</span><span class="fl">0.0</span>, disp<span class="op">=</span><span class="dv">0</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>predictions_win_final <span class="op">=</span> result_win_final.predict(sm.add_constant(X_test_win))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="model-evaluation" class="level4" data-number="4.1.2">
<h4 data-number="4.1.2" class="anchored" data-anchor-id="model-evaluation"><span class="header-section-number">4.1.2</span> Model evaluation:</h4>
<section id="significant-coefficients" class="level5">
<h5 class="anchored" data-anchor-id="significant-coefficients">Significant coefficients:</h5>
<div class="cell" data-execution_count="69">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>params_win_final <span class="op">=</span> result_win_final.params[<span class="dv">1</span>:].to_frame(name<span class="op">=</span><span class="st">"Coefficient"</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>params_win_final[<span class="st">"p-value"</span>] <span class="op">=</span> result_win_final.pvalues[<span class="dv">1</span>:].values</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>params_win_final.index <span class="op">=</span> home_win_final_features.columns</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"Significant Coefficients:"</span>))</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>display(</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    params_win_final.sort_values(<span class="st">"Coefficient"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    .loc[params_win_final[<span class="st">"p-value"</span>] <span class="op">&lt;</span> significance]</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    .style.<span class="bu">format</span>({<span class="st">"Coefficient"</span>: <span class="st">"</span><span class="sc">{:.3f}</span><span class="st">"</span>})</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p>Significant Coefficients:</p>
</div>
<div class="cell-output cell-output-display">
<style type="text/css">
</style>

<table id="T_1b62a" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_1b62a_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Coefficient</th>
<th id="T_1b62a_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_1b62a_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">overall_rating_avg_diff</td>
<td id="T_1b62a_row0_col0" class="data row0 col0">0.612</td>
<td id="T_1b62a_row0_col1" class="data row0 col1">0.000000</td>
</tr>
<tr class="even">
<td id="T_1b62a_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">vision_avg_diff</td>
<td id="T_1b62a_row1_col0" class="data row1 col0">0.177</td>
<td id="T_1b62a_row1_col1" class="data row1 col1">0.013564</td>
</tr>
<tr class="odd">
<td id="T_1b62a_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">standing_tackle_avg_diff</td>
<td id="T_1b62a_row2_col0" class="data row2 col0">0.174</td>
<td id="T_1b62a_row2_col1" class="data row2 col1">0.048862</td>
</tr>
<tr class="even">
<td id="T_1b62a_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">sliding_tackle_avg_diff</td>
<td id="T_1b62a_row3_col0" class="data row3 col0">-0.218</td>
<td id="T_1b62a_row3_col1" class="data row3 col1">0.012162</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="classification-report-5" class="level5">
<h5 class="anchored" data-anchor-id="classification-report-5">Classification report:</h5>
<div class="cell" data-execution_count="70">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test_win, predictions_win_final.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.67      0.77      0.72       933
           1       0.65      0.52      0.58       736

    accuracy                           0.66      1669
   macro avg       0.66      0.65      0.65      1669
weighted avg       0.66      0.66      0.66      1669
</code></pre>
</div>
</div>
</section>
<section id="receiver-operating-characteristic-curve-1" class="level5">
<h5 class="anchored" data-anchor-id="receiver-operating-characteristic-curve-1">Receiver Operating Characteristic Curve:</h5>
<div class="cell" data-execution_count="71">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, roc_auc_score</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_test_win, predictions_win_final)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>auc_score <span class="op">=</span> roc_auc_score(y_test_win, predictions_win_final)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>fig_roc, ax_roc <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(base_fig_width, base_fig_height))</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>ax_roc.plot(fpr, tpr, label<span class="op">=</span><span class="st">"ROC curve (AUC = </span><span class="sc">%0.2f</span><span class="st">)"</span> <span class="op">%</span> auc_score)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>ax_roc.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"k--"</span>)  <span class="co"># Random guessing line</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>ax_roc.set_xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>ax_roc.set_ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>ax_roc.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="analysis_files/figure-html/cell-80-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="away-win" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="away-win"><span class="header-section-number">4.2</span> Away win</h3>
<section id="modeling-and-predictions" class="level4" data-number="4.2.1">
<h4 data-number="4.2.1" class="anchored" data-anchor-id="modeling-and-predictions"><span class="header-section-number">4.2.1</span> Modeling and predictions:</h4>
<section id="preparing-the-home-loss-outcome-data" class="level5">
<h5 class="anchored" data-anchor-id="preparing-the-home-loss-outcome-data">Preparing the home loss outcome data:</h5>
<div class="cell" data-execution_count="72">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>match_win_final_df <span class="op">=</span> match_win_final_df.join(match_raw[<span class="st">"outcome"</span>])</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>match_win_final_df[<span class="st">"w_l_t"</span>] <span class="op">=</span> match_win_final_df[<span class="st">"outcome"</span>].<span class="bu">apply</span>(</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="st">"Home Win"</span> <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> (<span class="st">"Home Loss"</span> <span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"Tie"</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>match_win_final_df[<span class="st">"w_l_t"</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    match_win_final_df[<span class="st">"w_l_t"</span>],</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">"Home Loss"</span>, <span class="st">"Tie"</span>, <span class="st">"Home Win"</span>],</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    ordered<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>match_win_final_df[<span class="st">"home_loss"</span>] <span class="op">=</span> match_win_final_df[<span class="st">"w_l_t"</span>].<span class="bu">apply</span>(</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">"Home Loss"</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model-fitting-and-predictions" class="level5">
<h5 class="anchored" data-anchor-id="model-fitting-and-predictions">Model fitting and predictions</h5>
<div class="cell" data-execution_count="73">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>home_loss_final_target <span class="op">=</span> match_win_final_df[<span class="st">"home_loss"</span>]</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>home_loss_final_features <span class="op">=</span> match_win_final_df[</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    team_feat_names <span class="op">+</span> rfe_selected_columns.to_list()</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>X_train_loss, X_test_loss, y_train_loss, y_test_loss <span class="op">=</span> train_test_split(</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    home_loss_final_features,</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    home_loss_final_target,</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.33</span>,</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling the data</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>final_feat_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>X_train_loss <span class="op">=</span> player_feat_scaler.fit_transform(X_train_loss)</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>X_test_loss <span class="op">=</span> player_feat_scaler.fit_transform(X_test_loss)</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>logit_model_loss <span class="op">=</span> sm.Logit(y_train_loss, sm.add_constant(X_train_loss))</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>result_loss_final <span class="op">=</span> logit_model_loss.fit_regularized(</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">"l1_cvxopt_cp"</span>, alpha<span class="op">=</span><span class="dv">0</span>, disp<span class="op">=</span><span class="dv">0</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>predictions_loss_final <span class="op">=</span> result_loss_final.predict(sm.add_constant(X_test_loss))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="evaluating-the-model" class="level4" data-number="4.2.2">
<h4 data-number="4.2.2" class="anchored" data-anchor-id="evaluating-the-model"><span class="header-section-number">4.2.2</span> Evaluating the model</h4>
<section id="coefficient-importance" class="level5">
<h5 class="anchored" data-anchor-id="coefficient-importance">Coefficient importance:</h5>
<div class="cell" data-execution_count="74">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>params_loss_final <span class="op">=</span> result_loss_final.params[<span class="dv">1</span>:].to_frame(name<span class="op">=</span><span class="st">"Coefficient"</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>params_loss_final[<span class="st">"p-value"</span>] <span class="op">=</span> result_loss_final.pvalues[<span class="dv">1</span>:].values</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>params_loss_final.index <span class="op">=</span> home_loss_final_features.columns</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"Significant Coefficients:"</span>))</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>display(</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    params_loss_final.sort_values(<span class="st">"Coefficient"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    .loc[params_loss_final[<span class="st">"p-value"</span>] <span class="op">&lt;</span> significance]</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    .style.<span class="bu">format</span>({<span class="st">"Coefficient"</span>: <span class="st">"</span><span class="sc">{:.3f}</span><span class="st">"</span>})</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p>Significant Coefficients:</p>
</div>
<div class="cell-output cell-output-display">
<style type="text/css">
</style>

<table id="T_06aa9" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_06aa9_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Coefficient</th>
<th id="T_06aa9_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_06aa9_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">sliding_tackle_avg_diff</td>
<td id="T_06aa9_row0_col0" class="data row0 col0">0.202</td>
<td id="T_06aa9_row0_col1" class="data row0 col1">0.031679</td>
</tr>
<tr class="even">
<td id="T_06aa9_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">vision_avg_diff</td>
<td id="T_06aa9_row1_col0" class="data row1 col0">-0.215</td>
<td id="T_06aa9_row1_col1" class="data row1 col1">0.005178</td>
</tr>
<tr class="odd">
<td id="T_06aa9_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">overall_rating_avg_diff</td>
<td id="T_06aa9_row2_col0" class="data row2 col0">-0.636</td>
<td id="T_06aa9_row2_col1" class="data row2 col1">0.000000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="75">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test_loss, predictions_loss_final.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.76      0.92      0.83      1178
           1       0.61      0.28      0.38       491

    accuracy                           0.74      1669
   macro avg       0.68      0.60      0.61      1669
weighted avg       0.71      0.74      0.70      1669
</code></pre>
</div>
</div>
</section>
<section id="receiver-operating-characteristic-curve-2" class="level5">
<h5 class="anchored" data-anchor-id="receiver-operating-characteristic-curve-2">Receiver Operating Characteristic Curve:</h5>
<div class="cell" data-execution_count="76">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_test_loss, predictions_loss_final)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>auc_score <span class="op">=</span> roc_auc_score(y_test_loss, predictions_loss_final)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>fig_roc_loss, ax_roc_loss <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(base_fig_width, base_fig_height))</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>ax_roc_loss.plot(fpr, tpr, label<span class="op">=</span><span class="st">"ROC curve (AUC = </span><span class="sc">%0.2f</span><span class="st">)"</span> <span class="op">%</span> auc_score)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>ax_roc_loss.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"k--"</span>)  <span class="co"># Random guessing line</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>ax_roc_loss.set_xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>ax_roc_loss.set_ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>ax_roc_loss.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="analysis_files/figure-html/cell-85-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="win-loss-tie-classification" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored"><span class="header-section-number">4.3</span> Win-Loss-Tie Classification</h3>
<section id="ordinal-model" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="ordinal-model"><span class="header-section-number">4.3.1</span> Ordinal Model</h4>
<div class="cell" data-execution_count="77">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.miscmodels.ordinal_model <span class="im">import</span> OrderedModel</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>home_win_final_target <span class="op">=</span> match_win_final_df[<span class="st">"w_l_t"</span>]</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>home_win_final_features <span class="op">=</span> match_win_final_df[</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    team_feat_names <span class="op">+</span> rfe_selected_columns.to_list()</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>    home_win_final_features,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>    home_win_final_target,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.33</span>,</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling the data</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>final_feat_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> player_feat_scaler.fit_transform(X_train)</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> player_feat_scaler.fit_transform(X_test)</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>ordered_log_model <span class="op">=</span> OrderedModel(y_train, X_train)</span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>result_multi_logit <span class="op">=</span> ordered_log_model.fit(maxiter<span class="op">=</span><span class="dv">10000</span>)</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>predictions_wlt <span class="op">=</span> result_multi_logit.predict(X_test)</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the predicted probabilities</span></span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(np.asarray(y_test.values.codes), predictions_wlt.argmax(<span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.990864
         Iterations: 3516
         Function evaluations: 4596
              precision    recall  f1-score   support

           0       0.48      0.53      0.50       491
           1       0.00      0.00      0.00       442
           2       0.52      0.80      0.63       736

    accuracy                           0.51      1669
   macro avg       0.33      0.44      0.38      1669
weighted avg       0.37      0.51      0.43      1669
</code></pre>
</div>
</div>
</section>
<section id="custom-classification-based-on-home-win-and-home-loss-probabilities" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored"><span class="header-section-number">4.3.2</span> Custom Classification based on home win and home loss probabilities:</h4>
<section id="calculating-win-and-loss-probabilities-for-the-training-set" class="level5">
<h5 class="anchored">Calculating win and loss probabilities for the training set:</h5>
<div class="cell" data-execution_count="78">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>predicts_both <span class="op">=</span> pd.DataFrame(</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"win"</span>: result_win_final.predict(sm.add_constant(X_train_win)),</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"loss"</span>: result_loss_final.predict(sm.add_constant(X_train_loss)),</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="79">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> Parameters()</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>params.add(<span class="st">"coef_a"</span>, value<span class="op">=</span><span class="fl">0.1</span>, <span class="bu">min</span><span class="op">=</span><span class="fl">0.01</span>, <span class="bu">max</span><span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>params.add(<span class="st">"coef_b"</span>, value<span class="op">=</span><span class="fl">0.25</span>, <span class="bu">min</span><span class="op">=</span><span class="fl">0.01</span>, <span class="bu">max</span><span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>minner <span class="op">=</span> Minimizer(classifier_train_prob_dif, params, fcn_args<span class="op">=</span>(predicts_both, y_train))</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>result_final_class <span class="op">=</span> minner.minimize(method<span class="op">=</span><span class="st">"basinhopping"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="80">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>result_final_class</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="80">
<h2 class="anchored" data-anchor-id="calculating-win-and-loss-probabilities-for-the-training-set">Fit Result</h2> 
<table class="jp-toc-ignore table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Fit Statistics</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">fitting method</td>
<td style="text-align: right;">basinhopping</td>
</tr>
<tr class="even">
<td style="text-align: left;"># function evals</td>
<td style="text-align: right;">303</td>
</tr>
<tr class="odd">
<td style="text-align: left;"># data points</td>
<td style="text-align: right;">3386</td>
</tr>
<tr class="even">
<td style="text-align: left;"># variables</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chi-square</td>
<td style="text-align: right;">1622.00000</td>
</tr>
<tr class="even">
<td style="text-align: left;">reduced chi-square</td>
<td style="text-align: right;">0.47931442</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Akaike info crit.</td>
<td style="text-align: right;">-2488.05986</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bayesian info crit.</td>
<td style="text-align: right;">-2475.80506</td>
</tr>
</tbody>
</table>
<table class="jp-toc-ignore table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Parameters</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">name</td>
<td style="text-align: left;" data-quarto-table-cell-role="th">value</td>
<td style="text-align: left;" data-quarto-table-cell-role="th">initial value</td>
<td style="text-align: left;" data-quarto-table-cell-role="th">min</td>
<td style="text-align: left;" data-quarto-table-cell-role="th">max</td>
<td style="text-align: right;" data-quarto-table-cell-role="th">vary</td>
</tr>
<tr class="even">
<td style="text-align: left;">coef_a</td>
<td style="text-align: left;">0.01147856</td>
<td style="text-align: left;">0.1</td>
<td style="text-align: left;">0.01000000</td>
<td style="text-align: left;">0.50000000</td>
<td style="text-align: right;">True</td>
</tr>
<tr class="odd">
<td style="text-align: left;">coef_b</td>
<td style="text-align: left;">0.04516939</td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">0.01000000</td>
<td style="text-align: left;">0.50000000</td>
<td style="text-align: right;">True</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="81">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>final_predict <span class="op">=</span> pd.DataFrame(</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"win"</span>: predictions_win_final, <span class="st">"loss"</span>: predictions_loss_final}</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>final_predict[<span class="st">"guess"</span>] <span class="op">=</span> predicts_both.<span class="bu">apply</span>(</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    outcome_guess_prob_dif,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    args<span class="op">=</span>(</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>        result_final_class.params[<span class="st">"coef_a"</span>].value,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>        result_final_class.params[<span class="st">"coef_b"</span>].value,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, final_predict[<span class="st">"guess"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

   Home Loss       0.32      0.29      0.31       491
    Home Win       0.44      0.67      0.53       736
         Tie       0.29      0.06      0.10       442

    accuracy                           0.40      1669
   macro avg       0.35      0.34      0.31      1669
weighted avg       0.36      0.40      0.35      1669
</code></pre>
</div>
</div>
</section>
</section>
<section id="custom-classification-based-on-home-win-probabilities" class="level4" data-number="4.3.3">
<h4 data-number="4.3.3" class="anchored" data-anchor-id="custom-classification-based-on-home-win-probabilities"><span class="header-section-number">4.3.3</span> Custom classification based on home-win probabilities</h4>
<div class="cell" data-execution_count="82">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>params_prob <span class="op">=</span> Parameters()</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>params_prob.add(<span class="st">"coef_win"</span>, value<span class="op">=</span><span class="fl">0.1</span>, <span class="bu">min</span><span class="op">=</span><span class="fl">0.1</span>, <span class="bu">max</span><span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>params_prob.add(<span class="st">"coef_loss"</span>, value<span class="op">=</span><span class="fl">0.25</span>, <span class="bu">min</span><span class="op">=</span><span class="fl">0.1</span>, <span class="bu">max</span><span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>minner <span class="op">=</span> Minimizer(</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    classifier_train_prob_win, params_prob, fcn_args<span class="op">=</span>(predicts_both[<span class="st">"win"</span>], y_train)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>result_final_class <span class="op">=</span> minner.minimize(method<span class="op">=</span><span class="st">"basinhopping"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="83">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>final_pred <span class="op">=</span> pd.Series(predictions_win_final).<span class="bu">apply</span>(</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    outcome_guess_prob_win,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    args<span class="op">=</span>(</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>        result_final_class.params[<span class="st">"coef_win"</span>].value,</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>        result_final_class.params[<span class="st">"coef_loss"</span>].value,</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, final_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

   Home Loss       0.43      0.75      0.54       491
    Home Win       0.64      0.52      0.58       736
         Tie       0.31      0.14      0.20       442

    accuracy                           0.49      1669
   macro avg       0.46      0.47      0.44      1669
weighted avg       0.49      0.49      0.47      1669
</code></pre>
</div>
</div>
<p>Linear model</p>
<div class="cell" data-execution_count="100">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>player_att_dict <span class="op">=</span> {}</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> match_win_df_player.index:</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    player_att_dict[i] <span class="op">=</span> match_win_df_player.at[</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>        i, <span class="st">"match_players"</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    ].export_player_attributes(player_attr_numeric, how<span class="op">=</span><span class="st">"avg"</span>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>goals_df <span class="op">=</span> pd.DataFrame.from_dict(player_att_dict, orient<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropping rows with missing values</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>goals_df.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="co"># In some cases missing attributes were returned as empty dictionaries, dropping these rows</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>goals_df <span class="op">=</span> goals_df[</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>    goals_df.<span class="bu">apply</span>(</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: <span class="va">False</span> <span class="cf">if</span> <span class="bu">dict</span> <span class="kw">in</span> [<span class="bu">type</span>(i) <span class="cf">for</span> i <span class="kw">in</span> x.values] <span class="cf">else</span> <span class="va">True</span>, axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>goals_df <span class="op">=</span> goals_df.join(match_raw[<span class="st">"outcome"</span>])</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>goals_df <span class="op">=</span> goals_df.astype(<span class="bu">int</span>)</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>goals_df <span class="op">=</span> goals_df.drop(</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"overall_rating_H_avg"</span>,</span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"potential_H_avg"</span>,</span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"overall_rating_A_avg"</span>,</span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"potential_A_avg"</span>,</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"overall_rating_H_gk"</span>,</span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"potential_H_gk"</span>,</span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"overall_rating_A_gk"</span>,</span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"potential_A_gk"</span>,</span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="dropping-observationally-useless-stats" class="level4" data-number="4.3.4">
<h4 data-number="4.3.4" class="anchored" data-anchor-id="dropping-observationally-useless-stats"><span class="header-section-number">4.3.4</span> Dropping observationally useless stats</h4>
<section id="regular-player-goal-keeping-stats" class="level5">
<h5 class="anchored" data-anchor-id="regular-player-goal-keeping-stats">Regular player goal keeping stats:</h5>
<div class="cell" data-execution_count="101">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>player_gk_stats <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> goals_df.columns <span class="cf">if</span> (i[:<span class="dv">2</span>] <span class="op">==</span> <span class="st">"gk"</span> <span class="kw">and</span> i[<span class="op">-</span><span class="dv">2</span>:] <span class="op">!=</span> <span class="st">"gk"</span>)]</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>goals_df <span class="op">=</span> goals_df.drop(columns<span class="op">=</span>player_gk_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="irrelevant-goal-keeper-stats-based-on-average-values-being-low" class="level5">
<h5 class="anchored" data-anchor-id="irrelevant-goal-keeper-stats-based-on-average-values-being-low">Irrelevant goal keeper stats based on average values being low:</h5>
<div class="cell" data-execution_count="102">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>irrelevant_gk_stats <span class="op">=</span> (</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    goals_df[[i <span class="cf">for</span> i <span class="kw">in</span> goals_df.columns <span class="cf">if</span> i[<span class="op">-</span><span class="dv">2</span>:] <span class="op">==</span> <span class="st">"gk"</span>]]</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    .mean()[goals_df[[i <span class="cf">for</span> i <span class="kw">in</span> goals_df.columns <span class="cf">if</span> i[<span class="op">-</span><span class="dv">2</span>:] <span class="op">==</span> <span class="st">"gk"</span>]].mean() <span class="op">&lt;</span> <span class="dv">30</span>]</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    .index.to_list()</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>goals_df <span class="op">=</span> goals_df.drop(columns<span class="op">=</span>irrelevant_gk_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="dropping-strong-linear-correlations" class="level4" data-number="4.3.5">
<h4 data-number="4.3.5" class="anchored" data-anchor-id="dropping-strong-linear-correlations"><span class="header-section-number">4.3.5</span> Dropping strong linear correlations</h4>
<div class="cell" data-execution_count="103">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>disf.get_correlation_pairs(goals_df, <span class="fl">0.9</span>, <span class="op">-</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="103">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">r-value</th>
<th data-quarto-table-cell-role="th">feature_pair</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.928173</td>
<td>(short_passing_H_avg, long_passing_H_avg)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.946143</td>
<td>(short_passing_H_avg, ball_control_H_avg)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.908599</td>
<td>(short_passing_H_avg, reactions_H_avg)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.914209</td>
<td>(ball_control_H_avg, dribbling_H_avg)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>0.910845</td>
<td>(ball_control_H_avg, reactions_H_avg)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>0.938733</td>
<td>(sliding_tackle_H_avg, standing_tackle_H_avg)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>0.903585</td>
<td>(gk_diving_H_gk, gk_reflexes_H_gk)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>0.928766</td>
<td>(long_passing_A_avg, short_passing_A_avg)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>0.942833</td>
<td>(ball_control_A_avg, short_passing_A_avg)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>0.908592</td>
<td>(reactions_A_avg, short_passing_A_avg)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>0.910627</td>
<td>(dribbling_A_avg, ball_control_A_avg)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>0.908793</td>
<td>(reactions_A_avg, ball_control_A_avg)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>0.900987</td>
<td>(marking_A_avg, standing_tackle_A_avg)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>0.940536</td>
<td>(sliding_tackle_A_avg, standing_tackle_A_avg)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>0.903934</td>
<td>(gk_reflexes_A_gk, gk_diving_A_gk)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="104">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster 1 summarized by ball_control</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>corr_to_drop <span class="op">=</span> [</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"long_passing_H_avg"</span>,</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"short_passing_H_avg"</span>,</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"reactions_H_avg"</span>,</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dribbling_H_avg"</span>,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"long_passing_A_avg"</span>,</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"short_passing_A_avg"</span>,</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"reactions_A_avg"</span>,</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dribbling_A_avg"</span>,</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster 2 sliding/standing tackles</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>corr_to_drop.extend([<span class="st">"sliding_tackle_H_avg"</span>, <span class="st">"standing_tackle_A_avg"</span>])</span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster 3 gk reflexes/diving</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>corr_to_drop.extend([<span class="st">"gk_diving_H_gk"</span>, <span class="st">"gk_diving_A_gk"</span>])</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>goals_df <span class="op">=</span> goals_df.drop(columns<span class="op">=</span>corr_to_drop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="117">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into training and test sets</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>    goals_df.drop(columns<span class="op">=</span><span class="st">"outcome"</span>),</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    goals_df[<span class="st">"outcome"</span>],</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.33</span>,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling the data</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>team_feat_scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> team_feat_scaler.fit_transform(X_train)</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> team_feat_scaler.fit_transform(X_test)</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>lin_reg_pre_rfe <span class="op">=</span> LinearRegression()</span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>lin_rfe <span class="op">=</span> RFECV(lin_reg_pre_rfe, step<span class="op">=</span><span class="dv">1</span>, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>lin_rfe <span class="op">=</span> lin_rfe.fit(X_train, y_train)</span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the logistic regression model</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>goal_model_all <span class="op">=</span> sm.OLS(y_train, sm.add_constant(X_train[:, lin_rfe.support_]))</span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a>result_goal_all <span class="op">=</span> goal_model_all.fit()</span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a>predictions_goal_all <span class="op">=</span> result_goal_all.predict(</span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a>    sm.add_constant(X_test[:, lin_rfe.support_])</span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="118">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>params_goal_all <span class="op">=</span> pd.DataFrame(</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Coefficient"</span>: result_goal_all.params[<span class="dv">1</span>:].values,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"p-value"</span>: result_goal_all.pvalues[<span class="dv">1</span>:].values,</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># index=goals_df.drop(columns="outcome").columns,</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>goals_df.drop(columns<span class="op">=</span><span class="st">"outcome"</span>).columns[lin_rfe.support_],</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>params_goal_all.loc[params_goal_all[<span class="st">"p-value"</span>] <span class="op">&lt;</span> significance].sort_values(</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Coefficient"</span>, key<span class="op">=</span><span class="kw">lambda</span> x: <span class="bu">abs</span>(x), ascending<span class="op">=</span><span class="va">False</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="118">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Coefficient</th>
<th data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ball_control_A_avg</td>
<td>-0.509957</td>
<td>6.474667e-16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ball_control_H_avg</td>
<td>0.486730</td>
<td>1.379674e-13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">vision_H_avg</td>
<td>0.194598</td>
<td>2.354334e-03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">finishing_H_avg</td>
<td>0.171463</td>
<td>8.903101e-04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">stamina_A_avg</td>
<td>-0.156420</td>
<td>4.179071e-05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">crossing_A_avg</td>
<td>-0.144600</td>
<td>7.165704e-03</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="108">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>sns.histplot(result_goal_all.resid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>&lt;Axes: ylabel='Count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="analysis_files/figure-html/cell-100-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="109">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>np.sqrt(((y_test <span class="op">-</span> predictions_goal_all) <span class="op">**</span> <span class="dv">2</span>).<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(y_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>1.6355887717510031</code></pre>
</div>
</div>
<div class="cell" data-execution_count="110">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_test, predictions_goal_all.<span class="bu">round</span>())</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predictions_goal_all.<span class="bu">round</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

          -6       0.00      0.00      0.00         4
          -5       0.00      0.00      0.00         3
          -4       0.00      0.00      0.00        20
          -3       0.00      0.00      0.00        52
          -2       0.24      0.04      0.07       137
          -1       0.27      0.24      0.26       275
           0       0.30      0.50      0.37       442
           1       0.23      0.37      0.28       322
           2       0.25      0.16      0.19       222
           3       0.20      0.01      0.02       117
           4       0.00      0.00      0.00        52
           5       0.00      0.00      0.00        12
           6       0.00      0.00      0.00         8
           7       0.00      0.00      0.00         1
           8       0.00      0.00      0.00         2

    accuracy                           0.27      1669
   macro avg       0.10      0.09      0.08      1669
weighted avg       0.23      0.27      0.23      1669
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="analysis_files/figure-html/cell-102-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="99">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>goals_df[<span class="st">"home_team_goal"</span>].hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="analysis_files/figure-html/cell-103-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="98">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>result_goal_all.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="98">
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>home_team_goal</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.143</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.140</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>46.77</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Thu, 20 Jul 2023</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>1.29e-103</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>10:15:12</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-5463.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>3386</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>1.095e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>3373</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>1.103e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>12</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">const</td>
<td>1.5162</td>
<td>0.021</td>
<td>72.493</td>
<td>0.000</td>
<td>1.475</td>
<td>1.557</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x1</td>
<td>0.0777</td>
<td>0.042</td>
<td>1.855</td>
<td>0.064</td>
<td>-0.004</td>
<td>0.160</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x2</td>
<td>0.1159</td>
<td>0.040</td>
<td>2.871</td>
<td>0.004</td>
<td>0.037</td>
<td>0.195</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x3</td>
<td>0.0846</td>
<td>0.054</td>
<td>1.576</td>
<td>0.115</td>
<td>-0.021</td>
<td>0.190</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x4</td>
<td>0.0764</td>
<td>0.026</td>
<td>2.917</td>
<td>0.004</td>
<td>0.025</td>
<td>0.128</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x5</td>
<td>0.1877</td>
<td>0.048</td>
<td>3.891</td>
<td>0.000</td>
<td>0.093</td>
<td>0.282</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x6</td>
<td>0.0740</td>
<td>0.022</td>
<td>3.394</td>
<td>0.001</td>
<td>0.031</td>
<td>0.117</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x7</td>
<td>-0.1355</td>
<td>0.042</td>
<td>-3.225</td>
<td>0.001</td>
<td>-0.218</td>
<td>-0.053</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x8</td>
<td>-0.0603</td>
<td>0.046</td>
<td>-1.322</td>
<td>0.186</td>
<td>-0.150</td>
<td>0.029</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x9</td>
<td>-0.1489</td>
<td>0.059</td>
<td>-2.532</td>
<td>0.011</td>
<td>-0.264</td>
<td>-0.034</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x10</td>
<td>-0.0961</td>
<td>0.028</td>
<td>-3.379</td>
<td>0.001</td>
<td>-0.152</td>
<td>-0.040</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x11</td>
<td>0.1016</td>
<td>0.042</td>
<td>2.435</td>
<td>0.015</td>
<td>0.020</td>
<td>0.183</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x12</td>
<td>-0.1177</td>
<td>0.031</td>
<td>-3.822</td>
<td>0.000</td>
<td>-0.178</td>
<td>-0.057</td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>334.058</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>1.992</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.000</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>472.935</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>0.772</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>2.01e-103</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>3.984</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>8.19</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</div>
</div>
</section>
</section>
</section>
<section id="summary" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="summary"><span class="header-section-number">5</span> Summary</h2>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>